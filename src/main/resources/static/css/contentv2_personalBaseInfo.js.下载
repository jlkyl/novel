/* Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.3.3
 *
 */
(function(e){e.fn.extend({slimScroll:function(g){var a=e.extend({width:"auto",height:"250px",size:"7px",color:"#ccc",position:"right",distance:"1px",start:"top",opacity:1,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#EEE",railOpacity:1,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"},g);this.each(function(){function u(d){if(r){d=d||window.event;var c=0;d.wheelDelta&&(c=-d.wheelDelta/120);d.detail&&(c=d.detail/3);e(d.target||d.srcTarget||d.srcElement).closest("."+a.wrapperClass).is(b.parent())&&m(c,!0);d.preventDefault&&!k&&d.preventDefault();k||(d.returnValue=!1)}}function m(d,e,g){k=!1;var f=d,h=b.outerHeight()-c.outerHeight();e&&(f=parseInt(c.css("top"))+d*parseInt(a.wheelStep)/100*c.outerHeight(),f=Math.min(Math.max(f,0),h),f=0<d?Math.ceil(f):Math.floor(f),c.css({top:f+"px"}));l=parseInt(c.css("top"))/(b.outerHeight()-c.outerHeight());f=l*(b[0].scrollHeight-b.outerHeight());g&&(f=d,d=f/b[0].scrollHeight*b.outerHeight(),d=Math.min(Math.max(d,0),h),c.css({top:d+"px"}));b.scrollTop(f);b.trigger("slimscrolling",~~f);v();p()}function C(){window.addEventListener?(this.addEventListener("DOMMouseScroll",u,!1),this.addEventListener("mousewheel",u,!1)):document.attachEvent("onmousewheel",u)}function w(){s=Math.max(b.outerHeight()/b[0].scrollHeight*b.outerHeight(),30);c.css({height:s+"px"});var a=s==b.outerHeight()?"none":"block";c.css({display:a})}
function v(){w();clearTimeout(A);l==~~l?(k=a.allowPageScroll,B!=l&&b.trigger("slimscroll",0==~~l?"top":"bottom")):k=!1;B=l;s>=b.outerHeight()?k=!0:(c.stop(!0,!0).fadeIn("fast"),a.railVisible&&h.stop(!0,!0).fadeIn("fast"))}function p(){a.alwaysVisible||(A=setTimeout(function(){a.disableFadeOut&&r||x||y||(c.fadeOut("slow"),h.fadeOut("slow"))},1E3))}var r,x,y,A,z,s,l,B,k=!1,b=e(this);if(b.parent().hasClass(a.wrapperClass)){var n=b.scrollTop(),c=b.parent().find("."+a.barClass),h=b.parent().find("."+a.railClass);w();if(e.isPlainObject(g)){if("height"in g&&"auto"==g.height){b.parent().css("height","auto");b.css("height","auto");var q=b.parent().parent().height();b.parent().css("height",q);b.css("height",q)}if("scrollTo"in g)n=parseInt(a.scrollTo);else if("scrollBy"in g)n+=parseInt(a.scrollBy);else if("destroy"in g){c.remove();h.remove();b.unwrap();return}m(n,!1,!0)}}else if(!(e.isPlainObject(g)&&"destroy"in g)){a.height="auto"==a.height?b.parent().height():a.height;n=e("<div></div>").addClass(a.wrapperClass).css({position:"relative",overflow:"hidden",width:a.width,height:a.height});b.css({overflow:"hidden",width:a.width,height:a.height});var h=e("<div></div>").addClass(a.railClass).css({width:a.size,height:"100%",position:"absolute",top:0,display:a.alwaysVisible&&a.railVisible?"block":"none","border-radius":a.railBorderRadius,background:a.railColor,opacity:a.railOpacity,zIndex:90}),c=e("<div></div>").addClass(a.barClass).css({background:a.color,width:a.size,position:"absolute",top:0,opacity:a.opacity,display:a.alwaysVisible?"block":"none","border-radius":a.borderRadius,BorderRadius:a.borderRadius,MozBorderRadius:a.borderRadius,WebkitBorderRadius:a.borderRadius,zIndex:99}),q="right"==a.position?{right:a.distance}:{left:a.distance};h.css(q);c.css(q);b.wrap(n);b.parent().append(c);b.parent().append(h);a.railDraggable&&c.bind("mousedown",function(a){var b=e(document);y=!0;t=parseFloat(c.css("top"));pageY=a.pageY;b.bind("mousemove.slimscroll",function(a){currTop=t+a.pageY-pageY;c.css("top",currTop);m(0,c.position().top,!1)});b.bind("mouseup.slimscroll",function(a){y=!1;p();b.unbind(".slimscroll")});return!1}).bind("selectstart.slimscroll",function(a){a.stopPropagation();a.preventDefault();return!1});h.hover(function(){v()},function(){p()});c.hover(function(){x=!0},function(){x=!1});b.hover(function(){r=!0;v();p()},function(){r=!1;p()});b.bind("touchstart",function(a,b){a.originalEvent.touches.length&&(z=a.originalEvent.touches[0].pageY)});b.bind("touchmove",function(b){k||b.originalEvent.preventDefault();b.originalEvent.touches.length&&(m((z-b.originalEvent.touches[0].pageY)/a.touchScrollStep,!0),z=b.originalEvent.touches[0].pageY)});w();"bottom"===a.start?(c.css({top:b.outerHeight()-c.outerHeight()}),m(0,!0)):"top"!==a.start&&(m(e(a.start).position().top,null,!0),a.alwaysVisible||c.hide());C()}});return this}});e.fn.extend({slimscroll:e.fn.slimScroll})})(jQuery);
/*
 * jQuery Form Plugin
 * version: 3.51.0-2014.06.20
 * Requires jQuery v1.5 or later
 * Copyright (c) 2014 M. Alsup
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses.
 * https://github.com/malsup/form#copyright-and-license
 */
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(e){"use strict";function t(t){var r=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).ajaxSubmit(r))}function r(t){var r=t.target,a=e(r);if(!a.is("[type=submit],[type=image]")){var n=a.closest("[type=submit]");if(0===n.length)return;r=n[0]}var i=this;if(i.clk=r,"image"==r.type)if(void 0!==t.offsetX)i.clk_x=t.offsetX,i.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var o=a.offset();i.clk_x=t.pageX-o.left,i.clk_y=t.pageY-o.top}else i.clk_x=t.pageX-r.offsetLeft,i.clk_y=t.pageY-r.offsetTop;setTimeout(function(){i.clk=i.clk_x=i.clk_y=null},100)}function a(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var n={};n.fileapi=void 0!==e("<input type='file'/>").get(0).files,n.formdata=void 0!==window.FormData;var i=!!e.fn.prop;e.fn.attr2=function(){if(!i)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function r(r){var a,n,i=e.param(r,t.traditional).split("&"),o=i.length,s=[];for(a=0;o>a;a++)i[a]=i[a].replace(/\+/g," "),n=i[a].split("="),s.push([decodeURIComponent(n[0]),decodeURIComponent(n[1])]);return s}function o(a){for(var n=new FormData,i=0;i<a.length;i++)n.append(a[i].name,a[i].value);if(t.extraData){var o=r(t.extraData);for(i=0;i<o.length;i++)o[i]&&n.append(o[i][0],o[i][1])}t.data=null;var s=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:u||"POST"});t.uploadProgress&&(s.xhr=function(){var r=e.ajaxSettings.xhr();return r.upload&&r.upload.addEventListener("progress",function(e){var r=0,a=e.loaded||e.position,n=e.total;e.lengthComputable&&(r=Math.ceil(a/n*100)),t.uploadProgress(e,a,n,r)},!1),r}),s.data=null;var c=s.beforeSend;return s.beforeSend=function(e,r){r.data=t.formData?t.formData:n,c&&c.call(this,e,r)},e.ajax(s)}function s(r){function n(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(r){a("cannot get iframe.contentWindow document: "+r)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(r){a("cannot get iframe.contentDocument: "+r),t=e.document}return t}function o(){function t(){try{var e=n(g).readyState;a("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(r){a("Server abort: ",r," (",r.name,")"),s(k),j&&clearTimeout(j),j=void 0}}var r=f.attr2("target"),i=f.attr2("action"),o="multipart/form-data",c=f.attr("enctype")||f.attr("encoding")||o;w.setAttribute("target",p),(!u||/post/i.test(u))&&w.setAttribute("method","POST"),i!=m.url&&w.setAttribute("action",m.url),m.skipEncodingOverride||u&&!/post/i.test(u)||f.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),m.timeout&&(j=setTimeout(function(){T=!0,s(D)},m.timeout));var l=[];try{if(m.extraData)for(var d in m.extraData)m.extraData.hasOwnProperty(d)&&l.push(e.isPlainObject(m.extraData[d])&&m.extraData[d].hasOwnProperty("name")&&m.extraData[d].hasOwnProperty("value")?e('<input type="hidden" name="'+m.extraData[d].name+'">').val(m.extraData[d].value).appendTo(w)[0]:e('<input type="hidden" name="'+d+'">').val(m.extraData[d]).appendTo(w)[0]);m.iframeTarget||v.appendTo("body"),g.attachEvent?g.attachEvent("onload",s):g.addEventListener("load",s,!1),setTimeout(t,15);try{w.submit()}catch(h){var x=document.createElement("form").submit;x.apply(w)}}finally{w.setAttribute("action",i),w.setAttribute("enctype",c),r?w.setAttribute("target",r):f.removeAttr("target"),e(l).remove()}}function s(t){if(!x.aborted&&!F){if(M=n(g),M||(a("cannot access response document"),t=k),t===D&&x)return x.abort("timeout"),void S.reject(x,"timeout");if(t==k&&x)return x.abort("server abort"),void S.reject(x,"error","server abort");if(M&&M.location.href!=m.iframeSrc||T){g.detachEvent?g.detachEvent("onload",s):g.removeEventListener("load",s,!1);var r,i="success";try{if(T)throw"timeout";var o="xml"==m.dataType||M.XMLDocument||e.isXMLDoc(M);if(a("isXml="+o),!o&&window.opera&&(null===M.body||!M.body.innerHTML)&&--O)return a("requeing onLoad callback, DOM not available"),void setTimeout(s,250);var u=M.body?M.body:M.documentElement;x.responseText=u?u.innerHTML:null,x.responseXML=M.XMLDocument?M.XMLDocument:M,o&&(m.dataType="xml"),x.getResponseHeader=function(e){var t={"content-type":m.dataType};return t[e.toLowerCase()]},u&&(x.status=Number(u.getAttribute("status"))||x.status,x.statusText=u.getAttribute("statusText")||x.statusText);var c=(m.dataType||"").toLowerCase(),l=/(json|script|text)/.test(c);if(l||m.textarea){var f=M.getElementsByTagName("textarea")[0];if(f)x.responseText=f.value,x.status=Number(f.getAttribute("status"))||x.status,x.statusText=f.getAttribute("statusText")||x.statusText;else if(l){var p=M.getElementsByTagName("pre")[0],h=M.getElementsByTagName("body")[0];p?x.responseText=p.textContent?p.textContent:p.innerText:h&&(x.responseText=h.textContent?h.textContent:h.innerText)}}else"xml"==c&&!x.responseXML&&x.responseText&&(x.responseXML=X(x.responseText));try{E=_(x,c,m)}catch(y){i="parsererror",x.error=r=y||i}}catch(y){a("error caught: ",y),i="error",x.error=r=y||i}x.aborted&&(a("upload aborted"),i=null),x.status&&(i=x.status>=200&&x.status<300||304===x.status?"success":"error"),"success"===i?(m.success&&m.success.call(m.context,E,"success",x),S.resolve(x.responseText,"success",x),d&&e.event.trigger("ajaxSuccess",[x,m])):i&&(void 0===r&&(r=x.statusText),m.error&&m.error.call(m.context,x,i,r),S.reject(x,"error",r),d&&e.event.trigger("ajaxError",[x,m,r])),d&&e.event.trigger("ajaxComplete",[x,m]),d&&!--e.active&&e.event.trigger("ajaxStop"),m.complete&&m.complete.call(m.context,x,i),F=!0,m.timeout&&clearTimeout(j),setTimeout(function(){m.iframeTarget?v.attr("src",m.iframeSrc):v.remove(),x.responseXML=null},100)}}}var c,l,m,d,p,v,g,x,y,b,T,j,w=f[0],S=e.Deferred();if(S.abort=function(e){x.abort(e)},r)for(l=0;l<h.length;l++)c=e(h[l]),i?c.prop("disabled",!1):c.removeAttr("disabled");if(m=e.extend(!0,{},e.ajaxSettings,t),m.context=m.context||m,p="jqFormIO"+(new Date).getTime(),m.iframeTarget?(v=e(m.iframeTarget),b=v.attr2("name"),b?p=b:v.attr2("name",p)):(v=e('<iframe name="'+p+'" src="'+m.iframeSrc+'" />'),v.css({position:"absolute",top:"-1000px",left:"-1000px"})),g=v[0],x={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var r="timeout"===t?"timeout":"aborted";a("aborting upload... "+r),this.aborted=1;try{g.contentWindow.document.execCommand&&g.contentWindow.document.execCommand("Stop")}catch(n){}v.attr("src",m.iframeSrc),x.error=r,m.error&&m.error.call(m.context,x,r,t),d&&e.event.trigger("ajaxError",[x,m,r]),m.complete&&m.complete.call(m.context,x,r)}},d=m.global,d&&0===e.active++&&e.event.trigger("ajaxStart"),d&&e.event.trigger("ajaxSend",[x,m]),m.beforeSend&&m.beforeSend.call(m.context,x,m)===!1)return m.global&&e.active--,S.reject(),S;if(x.aborted)return S.reject(),S;y=w.clk,y&&(b=y.name,b&&!y.disabled&&(m.extraData=m.extraData||{},m.extraData[b]=y.value,"image"==y.type&&(m.extraData[b+".x"]=w.clk_x,m.extraData[b+".y"]=w.clk_y)));var D=1,k=2,A=e("meta[name=csrf-token]").attr("content"),L=e("meta[name=csrf-param]").attr("content");L&&A&&(m.extraData=m.extraData||{},m.extraData[L]=A),m.forceSync?o():setTimeout(o,10);var E,M,F,O=50,X=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},C=e.parseJSON||function(e){return window.eval("("+e+")")},_=function(t,r,a){var n=t.getResponseHeader("content-type")||"",i="xml"===r||!r&&n.indexOf("xml")>=0,o=i?t.responseXML:t.responseText;return i&&"parsererror"===o.documentElement.nodeName&&e.error&&e.error("parsererror"),a&&a.dataFilter&&(o=a.dataFilter(o,r)),"string"==typeof o&&("json"===r||!r&&n.indexOf("json")>=0?o=C(o):("script"===r||!r&&n.indexOf("javascript")>=0)&&e.globalEval(o)),o};return S}if(!this.length)return a("ajaxSubmit: skipping submit process - no element selected"),this;var u,c,l,f=this;"function"==typeof t?t={success:t}:void 0===t&&(t={}),u=t.type||this.attr2("method"),c=t.url||this.attr2("action"),l="string"==typeof c?e.trim(c):"",l=l||window.location.href||"",l&&(l=(l.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:l,success:e.ajaxSettings.success,type:u||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var m={};if(this.trigger("form-pre-serialize",[this,t,m]),m.veto)return a("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return a("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var d=t.traditional;void 0===d&&(d=e.ajaxSettings.traditional);var p,h=[],v=this.formToArray(t.semantic,h);if(t.data&&(t.extraData=t.data,p=e.param(t.data,d)),t.beforeSubmit&&t.beforeSubmit(v,this,t)===!1)return a("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[v,this,t,m]),m.veto)return a("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var g=e.param(v,d);p&&(g=g?g+"&"+p:p),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+g,t.data=null):t.data=g;var x=[];if(t.resetForm&&x.push(function(){f.resetForm()}),t.clearForm&&x.push(function(){f.clearForm(t.includeHidden)}),!t.dataType&&t.target){var y=t.success||function(){};x.push(function(r){var a=t.replaceTarget?"replaceWith":"html";e(t.target)[a](r).each(y,arguments)})}else t.success&&x.push(t.success);if(t.success=function(e,r,a){for(var n=t.context||this,i=0,o=x.length;o>i;i++)x[i].apply(n,[e,r,a||f,f])},t.error){var b=t.error;t.error=function(e,r,a){var n=t.context||this;b.apply(n,[e,r,a,f])}}if(t.complete){var T=t.complete;t.complete=function(e,r){var a=t.context||this;T.apply(a,[e,r,f])}}var j=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}),w=j.length>0,S="multipart/form-data",D=f.attr("enctype")==S||f.attr("encoding")==S,k=n.fileapi&&n.formdata;a("fileAPI :"+k);var A,L=(w||D)&&!k;t.iframe!==!1&&(t.iframe||L)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){A=s(v)}):A=s(v):A=(w||D)&&k?o(v):e.ajax(t),f.removeData("jqxhr").data("jqxhr",A);for(var E=0;E<h.length;E++)h[E]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(n){if(n=n||{},n.delegation=n.delegation&&e.isFunction(e.fn.on),!n.delegation&&0===this.length){var i={s:this.selector,c:this.context};return!e.isReady&&i.s?(a("DOM not ready, queuing ajaxForm"),e(function(){e(i.s,i.c).ajaxForm(n)}),this):(a("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return n.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,r).on("submit.form-plugin",this.selector,n,t).on("click.form-plugin",this.selector,n,r),this):this.ajaxFormUnbind().bind("submit.form-plugin",n,t).bind("click.form-plugin",n,r)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,r){var a=[];if(0===this.length)return a;var i,o=this[0],s=this.attr("id"),u=t?o.getElementsByTagName("*"):o.elements;if(u&&!/MSIE [678]/.test(navigator.userAgent)&&(u=e(u).get()),s&&(i=e(':input[form="'+s+'"]').get(),i.length&&(u=(u||[]).concat(i))),!u||!u.length)return a;var c,l,f,m,d,p,h;for(c=0,p=u.length;p>c;c++)if(d=u[c],f=d.name,f&&!d.disabled)if(t&&o.clk&&"image"==d.type)o.clk==d&&(a.push({name:f,value:e(d).val(),type:d.type}),a.push({name:f+".x",value:o.clk_x},{name:f+".y",value:o.clk_y}));else if(m=e.fieldValue(d,!0),m&&m.constructor==Array)for(r&&r.push(d),l=0,h=m.length;h>l;l++)a.push({name:f,value:m[l]});else if(n.fileapi&&"file"==d.type){r&&r.push(d);var v=d.files;if(v.length)for(l=0;l<v.length;l++)a.push({name:f,value:v[l],type:d.type});else a.push({name:f,value:"",type:d.type})}else null!==m&&"undefined"!=typeof m&&(r&&r.push(d),a.push({name:f,value:m,type:d.type,required:d.required}));if(!t&&o.clk){var g=e(o.clk),x=g[0];f=x.name,f&&!x.disabled&&"image"==x.type&&(a.push({name:f,value:g.val()}),a.push({name:f+".x",value:o.clk_x},{name:f+".y",value:o.clk_y}))}return a},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var r=[];return this.each(function(){var a=this.name;if(a){var n=e.fieldValue(this,t);if(n&&n.constructor==Array)for(var i=0,o=n.length;o>i;i++)r.push({name:a,value:n[i]});else null!==n&&"undefined"!=typeof n&&r.push({name:this.name,value:n})}}),e.param(r)},e.fn.fieldValue=function(t){for(var r=[],a=0,n=this.length;n>a;a++){var i=this[a],o=e.fieldValue(i,t);null===o||"undefined"==typeof o||o.constructor==Array&&!o.length||(o.constructor==Array?e.merge(r,o):r.push(o))}return r},e.fieldValue=function(t,r){var a=t.name,n=t.type,i=t.tagName.toLowerCase();if(void 0===r&&(r=!0),r&&(!a||t.disabled||"reset"==n||"button"==n||("checkbox"==n||"radio"==n)&&!t.checked||("submit"==n||"image"==n)&&t.form&&t.form.clk!=t||"select"==i&&-1==t.selectedIndex))return null;if("select"==i){var o=t.selectedIndex;if(0>o)return null;for(var s=[],u=t.options,c="select-one"==n,l=c?o+1:u.length,f=c?o:0;l>f;f++){var m=u[f];if(m.selected){var d=m.value;if(d||(d=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value),c)return d;s.push(d)}}return s}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var r=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var a=this.type,n=this.tagName.toLowerCase();r.test(a)||"textarea"==n?this.value="":"checkbox"==a||"radio"==a?this.checked=!1:"select"==n?this.selectedIndex=-1:"file"==a?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(t===!0&&/hidden/.test(a)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var r=this.type;if("checkbox"==r||"radio"==r)this.checked=t;else if("option"==this.tagName.toLowerCase()){var a=e(this).parent("select");t&&a[0]&&"select-one"==a[0].type&&a.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1});
/*
 * jQuery Validation Plugin v1.13.0
 *
 * http://jqueryvalidation.org/
 *
 * Copyright (c) 2014 Jörn Zaefferer
 * Released under the MIT license
 */
(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory);}else{factory(jQuery);}}(function($){$.extend($.fn,{validate:function(options){if(!this.length){if(options&&options.debug&&window.console){console.warn("Nothing selected, can't validate, returning nothing.");}
return;}
var validator=$.data(this[0],"validator");if(validator){return validator;}
this.attr("novalidate","novalidate");validator=new $.validator(options,this[0]);$.data(this[0],"validator",validator);if(validator.settings.onsubmit){this.validateDelegate(":submit","click",function(event){if(validator.settings.submitHandler){validator.submitButton=event.target;}
if($(event.target).hasClass("cancel")){validator.cancelSubmit=true;}
if($(event.target).attr("formnovalidate")!==undefined){validator.cancelSubmit=true;}});this.submit(function(event){if(validator.settings.debug){event.preventDefault();}
function handle(){var hidden;if(validator.settings.submitHandler){if(validator.submitButton){hidden=$("<input type='hidden'/>").attr("name",validator.submitButton.name).val($(validator.submitButton).val()).appendTo(validator.currentForm);}
validator.settings.submitHandler.call(validator,validator.currentForm,event);if(validator.submitButton){hidden.remove();}
return false;}
return true;}
if(validator.cancelSubmit){validator.cancelSubmit=false;return handle();}
if(validator.form()){if(validator.pendingRequest){validator.formSubmitted=true;return false;}
return handle();}else{validator.focusInvalid();return false;}});}
return validator;},valid:function(){var valid,validator;if($(this[0]).is("form")){valid=this.validate().form();}else{valid=true;validator=$(this[0].form).validate();this.each(function(){valid=validator.element(this)&&valid;});}
return valid;},removeAttrs:function(attributes){var result={},$element=this;$.each(attributes.split(/\s/),function(index,value){result[value]=$element.attr(value);$element.removeAttr(value);});return result;},rules:function(command,argument){var element=this[0],settings,staticRules,existingRules,data,param,filtered;if(command){settings=$.data(element.form,"validator").settings;staticRules=settings.rules;existingRules=$.validator.staticRules(element);switch(command){case"add":$.extend(existingRules,$.validator.normalizeRule(argument));delete existingRules.messages;staticRules[element.name]=existingRules;if(argument.messages){settings.messages[element.name]=$.extend(settings.messages[element.name],argument.messages);}
break;case"remove":if(!argument){delete staticRules[element.name];return existingRules;}
filtered={};$.each(argument.split(/\s/),function(index,method){filtered[method]=existingRules[method];delete existingRules[method];if(method==="required"){$(element).removeAttr("aria-required");}});return filtered;}}
data=$.validator.normalizeRules($.extend({},$.validator.classRules(element),$.validator.attributeRules(element),$.validator.dataRules(element),$.validator.staticRules(element)),element);if(data.required){param=data.required;delete data.required;data=$.extend({required:param},data);$(element).attr("aria-required","true");}
if(data.remote){param=data.remote;delete data.remote;data=$.extend(data,{remote:param});}
return data;}});$.extend($.expr[":"],{blank:function(a){return!$.trim(""+$(a).val());},filled:function(a){return!!$.trim(""+$(a).val());},unchecked:function(a){return!$(a).prop("checked");}});$.validator=function(options,form){this.settings=$.extend(true,{},$.validator.defaults,options);this.currentForm=form;this.init();};$.validator.format=function(source,params){if(arguments.length===1){return function(){var args=$.makeArray(arguments);args.unshift(source);return $.validator.format.apply(this,args);};}
if(arguments.length>2&&params.constructor!==Array){params=$.makeArray(arguments).slice(1);}
if(params.constructor!==Array){params=[params];}
$.each(params,function(i,n){source=source.replace(new RegExp("\\{"+i+"\\}","g"),function(){return n;});});return source;};$.extend($.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"errorInput",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:$([]),errorLabelContainer:$([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(element){this.lastActive=element;if(this.settings.focusCleanup&&!this.blockFocusCleanup){if(this.settings.unhighlight){this.settings.unhighlight.call(this,element,this.settings.errorClass,this.settings.validClass);}
this.hideThese(this.errorsFor(element));}},onfocusout:function(element){if(!this.checkable(element)&&(element.name in this.submitted||!this.optional(element))){this.element(element);}},onkeyup:function(element,event){if(event.which===9&&this.elementValue(element)===""){return;}else if(element.name in this.submitted||element===this.lastElement){this.element(element);}},onclick:function(element){if(element.name in this.submitted){this.element(element);}else if(element.parentNode.name in this.submitted){this.element(element.parentNode);}},highlight:function(element,errorClass,validClass){if(element.type==="radio"){this.findByName(element.name).addClass(errorClass).removeClass(validClass);}else{$(element).addClass(errorClass).removeClass(validClass);}},unhighlight:function(element,errorClass,validClass){if(element.type==="radio"){this.findByName(element.name).removeClass(errorClass).addClass(validClass);}else{$(element).removeClass(errorClass).addClass(validClass);}}},setDefaults:function(settings){$.extend($.validator.defaults,settings);},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date ( ISO ).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:$.validator.format("Please enter no more than {0} characters."),minlength:$.validator.format("Please enter at least {0} characters."),rangelength:$.validator.format("Please enter a value between {0} and {1} characters long."),range:$.validator.format("Please enter a value between {0} and {1}."),max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=$(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||$(this.currentForm);this.containers=$(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var groups=(this.groups={}),rules;$.each(this.settings.groups,function(key,value){if(typeof value==="string"){value=value.split(/\s/);}
$.each(value,function(index,name){groups[name]=key;});});rules=this.settings.rules;$.each(rules,function(key,value){rules[key]=$.validator.normalizeRule(value);});function delegate(event){var validator=$.data(this[0].form,"validator"),eventType="on"+event.type.replace(/^validate/,""),settings=validator.settings;if(settings[eventType]&&!this.is(settings.ignore)){settings[eventType].call(validator,this[0],event);}}
$(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, "+"[type='number'], [type='search'] ,[type='tel'], [type='url'], "+"[type='email'], [type='datetime'], [type='date'], [type='month'], "+"[type='week'], [type='time'], [type='datetime-local'], "+"[type='range'], [type='color'], [type='radio'], [type='checkbox']","focusin focusout keyup",delegate).validateDelegate("select, option, [type='radio'], [type='checkbox']","click",delegate);if(this.settings.invalidHandler){$(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler);}
$(this.currentForm).find("[required], [data-rule-required], .required").attr("aria-required","true");},form:function(){this.checkForm();$.extend(this.submitted,this.errorMap);this.invalid=$.extend({},this.errorMap);if(!this.valid()){$(this.currentForm).triggerHandler("invalid-form",[this]);}
this.showErrors();return this.valid();},checkForm:function(){this.prepareForm();for(var i=0,elements=(this.currentElements=this.elements());elements[i];i++){this.check(elements[i]);}
return this.valid();},element:function(element){var cleanElement=this.clean(element),checkElement=this.validationTargetFor(cleanElement),result=true;this.lastElement=checkElement;if(checkElement===undefined){delete this.invalid[cleanElement.name];}else{this.prepareElement(checkElement);this.currentElements=$(checkElement);result=this.check(checkElement)!==false;if(result){delete this.invalid[checkElement.name];}else{this.invalid[checkElement.name]=true;}}
$(element).attr("aria-invalid",!result);if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers);}
this.showErrors();return result;},showErrors:function(errors){if(errors){$.extend(this.errorMap,errors);this.errorList=[];for(var name in errors){this.errorList.push({message:errors[name],element:this.findByName(name)[0]});}
this.successList=$.grep(this.successList,function(element){return!(element.name in errors);});}
if(this.settings.showErrors){this.settings.showErrors.call(this,this.errorMap,this.errorList);}else{this.defaultShowErrors();}},resetForm:function(){if($.fn.resetForm){$(this.currentForm).resetForm();}
this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass).removeData("previousValue").removeAttr("aria-invalid");},numberOfInvalids:function(){return this.objectLength(this.invalid);},objectLength:function(obj){var count=0,i;for(i in obj){count++;}
return count;},hideErrors:function(){this.hideThese(this.toHide);},hideThese:function(errors){errors.not(this.containers).text("");this.addWrapper(errors).hide();},valid:function(){return this.size()===0;},size:function(){return this.errorList.length;},focusInvalid:function(){if(this.settings.focusInvalid){try{$(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin");}catch(e){}}},findLastActive:function(){var lastActive=this.lastActive;return lastActive&&$.grep(this.errorList,function(n){return n.element.name===lastActive.name;}).length===1&&lastActive;},elements:function(){var validator=this,rulesCache={};return $(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){if(!this.name&&validator.settings.debug&&window.console){console.error("%o has no name assigned",this);}
if(this.name in rulesCache||!validator.objectLength($(this).rules())){return false;}
rulesCache[this.name]=true;return true;});},clean:function(selector){return $(selector)[0];},errors:function(){var errorClass=this.settings.errorClass.split(" ").join(".");return $(this.settings.errorElement+"."+errorClass,this.errorContext);},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=$([]);this.toHide=$([]);this.currentElements=$([]);},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers);},prepareElement:function(element){this.reset();this.toHide=this.errorsFor(element);},elementValue:function(element){var val,$element=$(element),type=element.type;if(type==="radio"||type==="checkbox"){return $("input[name='"+element.name+"']:checked").val();}else if(type==="number"&&typeof element.validity!=="undefined"){return element.validity.badInput?false:$element.val();}
val=$element.val();if(typeof val==="string"){return val.replace(/\r/g,"");}
return val;},check:function(element){element=this.validationTargetFor(this.clean(element));var rules=$(element).rules(),rulesCount=$.map(rules,function(n,i){return i;}).length,dependencyMismatch=false,val=this.elementValue(element),result,method,rule;for(method in rules){rule={method:method,parameters:rules[method]};try{result=$.validator.methods[method].call(this,val,element,rule.parameters);if(result==="dependency-mismatch"&&rulesCount===1){dependencyMismatch=true;continue;}
dependencyMismatch=false;if(result==="pending"){this.toHide=this.toHide.not(this.errorsFor(element));return;}
if(!result){this.formatAndAdd(element,rule);return false;}}catch(e){if(this.settings.debug&&window.console){console.log("Exception occurred when checking element "+element.id+", check the '"+rule.method+"' method.",e);}
throw e;}}
if(dependencyMismatch){return;}
if(this.objectLength(rules)){this.successList.push(element);}
return true;},customDataMessage:function(element,method){return $(element).data("msg"+method.charAt(0).toUpperCase()+
method.substring(1).toLowerCase())||$(element).data("msg");},customMessage:function(name,method){var m=this.settings.messages[name];return m&&(m.constructor===String?m:m[method]);},findDefined:function(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i];}}
return undefined;},defaultMessage:function(element,method){return this.findDefined(this.customMessage(element.name,method),this.customDataMessage(element,method),!this.settings.ignoreTitle&&element.title||undefined,$.validator.messages[method],"<strong>Warning: No message defined for "+element.name+"</strong>");},formatAndAdd:function(element,rule){var message=this.defaultMessage(element,rule.method),theregex=/\$?\{(\d+)\}/g;if(typeof message==="function"){message=message.call(this,rule.parameters,element);}else if(theregex.test(message)){message=$.validator.format(message.replace(theregex,"{$1}"),rule.parameters);}
this.errorList.push({message:message,element:element,method:rule.method});this.errorMap[element.name]=message;this.submitted[element.name]=message;},addWrapper:function(toToggle){if(this.settings.wrapper){toToggle=toToggle.add(toToggle.parent(this.settings.wrapper));}
return toToggle;},defaultShowErrors:function(){var i,elements,error;for(i=0;this.errorList[i];i++){error=this.errorList[i];if(this.settings.highlight){this.settings.highlight.call(this,error.element,this.settings.errorClass,this.settings.validClass);}
this.showLabel(error.element,error.message);}
if(this.errorList.length){this.toShow=this.toShow.add(this.containers);}
if(this.settings.success){for(i=0;this.successList[i];i++){this.showLabel(this.successList[i]);}}
if(this.settings.unhighlight){for(i=0,elements=this.validElements();elements[i];i++){this.settings.unhighlight.call(this,elements[i],this.settings.errorClass,this.settings.validClass);}}
this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show();},validElements:function(){return this.currentElements.not(this.invalidElements());},invalidElements:function(){return $(this.errorList).map(function(){return this.element;});},showLabel:function(element,message){var place,group,errorID,error=this.errorsFor(element),elementID=this.idOrName(element),describedBy=$(element).attr("aria-describedby");if(error.length){error.removeClass(this.settings.validClass).addClass(this.settings.errorClass);error.html(message);}else{error=$("<"+this.settings.errorElement+">").attr("id",elementID+"-error").addClass(this.settings.errorClass).html(message||"");place=error;if(this.settings.wrapper){place=error.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();}
if(this.labelContainer.length){this.labelContainer.append(place);}else if(this.settings.errorPlacement){this.settings.errorPlacement(place,$(element));}else{place.insertAfter(element);}
if(error.is("label")){error.attr("for",elementID);}else if(error.parents("label[for='"+elementID+"']").length===0){errorID=error.attr("id");if(!describedBy){describedBy=errorID;}else if(!describedBy.match(new RegExp("\b"+errorID+"\b"))){describedBy+=" "+errorID;}
$(element).attr("aria-describedby",describedBy);group=this.groups[element.name];if(group){$.each(this.groups,function(name,testgroup){if(testgroup===group){$("[name='"+name+"']",this.currentForm).attr("aria-describedby",error.attr("id"));}});}}}
if(!message&&this.settings.success){error.text("");if(typeof this.settings.success==="string"){error.addClass(this.settings.success);}else{this.settings.success(error,element);}}
this.toShow=this.toShow.add(error);},errorsFor:function(element){var name=this.idOrName(element),describer=$(element).attr("aria-describedby"),selector="label[for='"+name+"'], label[for='"+name+"'] *";if(describer){selector=selector+", #"+describer.replace(/\s+/g,", #");}
return this.errors().filter(selector);},idOrName:function(element){return this.groups[element.name]||(this.checkable(element)?element.name:element.id||element.name);},validationTargetFor:function(element){if(this.checkable(element)){element=this.findByName(element.name).not(this.settings.ignore)[0];}
return element;},checkable:function(element){return(/radio|checkbox/i).test(element.type);},findByName:function(name){return $(this.currentForm).find("[name='"+name+"']");},getLength:function(value,element){switch(element.nodeName.toLowerCase()){case"select":return $("option:selected",element).length;case"input":if(this.checkable(element)){return this.findByName(element.name).filter(":checked").length;}}
return value.length;},depend:function(param,element){return this.dependTypes[typeof param]?this.dependTypes[typeof param](param,element):true;},dependTypes:{"boolean":function(param){return param;},"string":function(param,element){return!!$(param,element.form).length;},"function":function(param,element){return param(element);}},optional:function(element){var val=this.elementValue(element);return!$.validator.methods.required.call(this,val,element)&&"dependency-mismatch";},startRequest:function(element){if(!this.pending[element.name]){this.pendingRequest++;this.pending[element.name]=true;}},stopRequest:function(element,valid){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0;}
delete this.pending[element.name];if(valid&&this.pendingRequest===0&&this.formSubmitted&&this.form()){$(this.currentForm).submit();this.formSubmitted=false;}else if(!valid&&this.pendingRequest===0&&this.formSubmitted){$(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false;}},previousValue:function(element){return $.data(element,"previousValue")||$.data(element,"previousValue",{old:null,valid:true,message:this.defaultMessage(element,"remote")});}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},number:{number:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(className,rules){if(className.constructor===String){this.classRuleSettings[className]=rules;}else{$.extend(this.classRuleSettings,className);}},classRules:function(element){var rules={},classes=$(element).attr("class");if(classes){$.each(classes.split(" "),function(){if(this in $.validator.classRuleSettings){$.extend(rules,$.validator.classRuleSettings[this]);}});}
return rules;},attributeRules:function(element){var rules={},$element=$(element),type=element.getAttribute("type"),method,value;for(method in $.validator.methods){if(method==="required"){value=element.getAttribute(method);if(value===""){value=true;}
value=!!value;}else{value=$element.attr(method);}
if(/min|max/.test(method)&&(type===null||/number|range|text/.test(type))){value=Number(value);}
if(value||value===0){rules[method]=value;}else if(type===method&&type!=="range"){rules[method]=true;}}
if(rules.maxlength&&/-1|2147483647|524288/.test(rules.maxlength)){delete rules.maxlength;}
return rules;},dataRules:function(element){var method,value,rules={},$element=$(element);for(method in $.validator.methods){value=$element.data("rule"+method.charAt(0).toUpperCase()+method.substring(1).toLowerCase());if(value!==undefined){rules[method]=value;}}
return rules;},staticRules:function(element){var rules={},validator=$.data(element.form,"validator");if(validator.settings.rules){rules=$.validator.normalizeRule(validator.settings.rules[element.name])||{};}
return rules;},normalizeRules:function(rules,element){$.each(rules,function(prop,val){if(val===false){delete rules[prop];return;}
if(val.param||val.depends){var keepRule=true;switch(typeof val.depends){case"string":keepRule=!!$(val.depends,element.form).length;break;case"function":keepRule=val.depends.call(element,element);break;}
if(keepRule){rules[prop]=val.param!==undefined?val.param:true;}else{delete rules[prop];}}});$.each(rules,function(rule,parameter){rules[rule]=$.isFunction(parameter)?parameter(element):parameter;});$.each(["minlength","maxlength"],function(){if(rules[this]){rules[this]=Number(rules[this]);}});$.each(["rangelength","range"],function(){var parts;if(rules[this]){if($.isArray(rules[this])){rules[this]=[Number(rules[this][0]),Number(rules[this][1])];}else if(typeof rules[this]==="string"){parts=rules[this].replace(/[\[\]]/g,"").split(/[\s,]+/);rules[this]=[Number(parts[0]),Number(parts[1])];}}});if($.validator.autoCreateRanges){if(rules.min&&rules.max){rules.range=[rules.min,rules.max];delete rules.min;delete rules.max;}
if(rules.minlength&&rules.maxlength){rules.rangelength=[rules.minlength,rules.maxlength];delete rules.minlength;delete rules.maxlength;}}
return rules;},normalizeRule:function(data){if(typeof data==="string"){var transformed={};$.each(data.split(/\s/),function(){transformed[this]=true;});data=transformed;}
return data;},addMethod:function(name,method,message){$.validator.methods[name]=method;$.validator.messages[name]=message!==undefined?message:$.validator.messages[name];if(method.length<3){$.validator.addClassRules(name,$.validator.normalizeRule(name));}},methods:{required:function(value,element,param){if(!this.depend(param,element)){return"dependency-mismatch";}
if(element.nodeName.toLowerCase()==="select"){var val=$(element).val();return val&&val.length>0;}
if(this.checkable(element)){return this.getLength(value,element)>0;}
return $.trim(value).length>0;},email:function(value,element){return this.optional(element)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(value);},url:function(value,element){return this.optional(element)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value);},date:function(value,element){return this.optional(element)||!/Invalid|NaN/.test(new Date(value).toString());},dateISO:function(value,element){return this.optional(element)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(value);},number:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(value);},digits:function(value,element){return this.optional(element)||/^\d+$/.test(value);},creditcard:function(value,element){if(this.optional(element)){return"dependency-mismatch";}
if(/[^0-9 \-]+/.test(value)){return false;}
var nCheck=0,nDigit=0,bEven=false,n,cDigit;value=value.replace(/\D/g,"");if(value.length<13||value.length>19){return false;}
for(n=value.length-1;n>=0;n--){cDigit=value.charAt(n);nDigit=parseInt(cDigit,10);if(bEven){if((nDigit*=2)>9){nDigit-=9;}}
nCheck+=nDigit;bEven=!bEven;}
return(nCheck%10)===0;},minlength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength($.trim(value),element);return this.optional(element)||length>=param;},maxlength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength($.trim(value),element);return this.optional(element)||length<=param;},rangelength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength($.trim(value),element);return this.optional(element)||(length>=param[0]&&length<=param[1]);},min:function(value,element,param){return this.optional(element)||value>=param;},max:function(value,element,param){return this.optional(element)||value<=param;},range:function(value,element,param){return this.optional(element)||(value>=param[0]&&value<=param[1]);},equalTo:function(value,element,param){var target=$(param);if(this.settings.onfocusout){target.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){$(element).valid();});}
return value===target.val();},remote:function(value,element,param){if(this.optional(element)){return"dependency-mismatch";}
var previous=this.previousValue(element),validator,data;if(!this.settings.messages[element.name]){this.settings.messages[element.name]={};}
previous.originalMessage=this.settings.messages[element.name].remote;this.settings.messages[element.name].remote=previous.message;param=typeof param==="string"&&{url:param}||param;if(previous.old===value){return previous.valid;}
previous.old=value;validator=this;this.startRequest(element);data={};data[element.name]=value;$.ajax($.extend(true,{url:param,mode:"abort",port:"validate"+element.name,dataType:"json",data:data,context:validator.currentForm,success:function(response){var valid=response===true||response==="true"||(response&&response.status===true),errors,message,submitted;validator.settings.messages[element.name].remote=previous.originalMessage;if(valid){submitted=validator.formSubmitted;validator.prepareElement(element);validator.formSubmitted=submitted;validator.successList.push(element);delete validator.invalid[element.name];validator.showErrors();}else{errors={};message=response||validator.defaultMessage(element,"remote");if(response&&response.info){message=response.info;}
errors[element.name]=previous.message=$.isFunction(message)?message(value):message;validator.invalid[element.name]=true;validator.showErrors(errors);}
previous.valid=valid;validator.stopRequest(element,valid);}},param));return"pending";}}});$.format=function deprecated(){throw"$.format has been deprecated. Please use $.validator.format instead.";};var pendingRequests={},ajax;if($.ajaxPrefilter){$.ajaxPrefilter(function(settings,_,xhr){var port=settings.port;if(settings.mode==="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}
pendingRequests[port]=xhr;}});}else{ajax=$.ajax;$.ajax=function(settings){var mode=("mode"in settings?settings:$.ajaxSettings).mode,port=("port"in settings?settings:$.ajaxSettings).port;if(mode==="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}
pendingRequests[port]=ajax.apply(this,arguments);return pendingRequests[port];}
return ajax.apply(this,arguments);};}
$.extend($.fn,{validateDelegate:function(delegate,type,handler){return this.bind(type,function(event){var target=$(event.target);if(target.is(delegate)){return handler.apply(target,arguments);}});}});}));jQuery.validator.addMethod("isPhone",function(value,element){var length=value.length;var mobile=/^(((13[0-9]{1})|(15[0-9]{1}))+\d{8})$/;var tel=/^\d{3,4}-?\d{7,9}$/;return this.optional(element)||(tel.test(value)||mobile.test(value));},"请正确填写您的联系电话");jQuery.validator.addMethod("isMobile",function(value,element){var length=value.length;var mobile=/^((13[0-9])|(14[0-35-9])|(15[0-35-9])|(17[0-35-9])|(18[0-9]))[0-9]{8}$/;return this.optional(element)||mobile.test(value);},"请正确填写您的手机号码");jQuery.validator.addMethod("isQQ",function(value,element){return this.optional(element)||/^[1-9][0-9]{4,9}$/.test(value);},"qq号码格式错误");jQuery.validator.addMethod("isEmail",function(value,element){return this.optional(element)||/^[a-zA-Z0-9_+.-]+\@([a-zA-Z0-9-]+\.)+[a-zA-Z0-9]{2,4}$/.test(value);},"邮箱地址不合法");jQuery.validator.addMethod("isZipCode",function(value,element){var tel=/^[0-9]{6}$/;return this.optional(element)||(tel.test(value));},"请正确填写您的邮政编码");jQuery.validator.addMethod("isRealName",function(value,element){return this.optional(element)||/^[\u4E00-\u9FFF·\u4dae]{2,4}$/.test(value);},"由2-4个汉字组成");jQuery.validator.addMethod("isIDCardV2",function(value,element){return this.optional(element)||/^([A-Za-z0-9\u4E00-\u9FFF]{8,18})$/.test(value);},"证证件号不合法");jQuery.validator.addMethod("isIDCard",function(value,element){return this.optional(element)||/^(\d{17}[xX\d])$/.test(value);},"身份证不合法");jQuery.validator.addMethod("isIDCardV3",function(value,element,param){if('0'==$(param).val())
{return this.optional(element)||/^(\d{17}[xX\d])$/.test(value);}
else
{return true;}},"身份证不合法");jQuery.validator.addMethod("notEqualTo",function(value,element,param){return value!=$(param).val();},"新密码不能和原始密码相同");jQuery.validator.addMethod("passwordCheck",function(value,element){return this.optional(element)||/^[A-Za-z0-9~!@#$%^&*()_+]{6,16}$/.test(value);},"6-16位英文、数字或特殊字符组成");jQuery.validator.addMethod("byteRangeLength",function(value,element,param){var length=value.length;for(var i=0;i<value.length;i++){if(value.charCodeAt(i)>127){length++;}}
return this.optional(element)||(length>=param[0]&&length<=param[1]);},$.validator.format("请确保输入的值在{0}-{1}个字节之间(一个中文字算2个字节)"));jQuery.validator.addMethod("byteRangeLengthByOne",function(value,element,param){value=value.replace(/\r\n/ig,"");value=value.replace(/\s+/g,'');var length=value.length;return this.optional(element)||(length>=param[0]&&length<=param[1]);},"请确保输入的值在20-500个字节之间(一个中文字算1个字节)");jQuery.validator.addMethod("phoneCheck",function(value,element,param){var length=value.length;if('+86'==$(param).val())
{var mobile=/^1[0-9]{10}$/;}
else
{var mobile=/^[0-9]{1,20}$/;}
return this.optional(element)||mobile.test(value);},"请输入正确的手机号码");(function($){var _util=CS.util;function regionalLinkage(areaarr){var $citySelect=$('#citySelect');var $areaSelect=$('#areaSelect');$('#provinceSelect').on('change',function(){var provinceName=$(this).val(),cityNameList=areaarr[provinceName];if(cityNameList){var arrCityTpl=[];$.each(cityNameList,function(index,item){arrCityTpl.push('<option value="'+index+'">'+index+'</option>');});$citySelect.html(arrCityTpl.join(''));var arrCityTpl=[];$.each(cityNameList[$('#citySelect').val()],function(index,item){arrCityTpl.push('<option value="'+item+'">'+item+'</option>');});$areaSelect.html(arrCityTpl.join(''));}});$('#citySelect').change(function(){var cityName=$(this).val(),provinceName=$('#provinceSelect').val(),cityNameList=areaarr[provinceName];if(cityNameList){var arrCityTpl=[];$.each(cityNameList[$('#citySelect').val()],function(index,item){arrCityTpl.push('<option value="'+item+'">'+item+'</option>');});$areaSelect.html(arrCityTpl.join(''));}});}
_util.initNameSpace("CS");CS.citySelection={'regionalLinkage':regionalLinkage};})(jQuery);(function($){var _util=CS.util,_dialog=CS.dialog,_areaLinkage=CS.citySelection;var _params={},_nodes={},_isSubmitting=0;var _ajaxUrls={'checkAuthorName':'/jpbook/users/getUsersByPen'};var str="请填写街道名称，门牌号码，楼层和房间号",_grayColor='color:rgb(192,192,192)',_blackColor="color:rgb(51,51,51)",
$address=$("input[name='address']");function init(ajaxGetProvince,isHasPassbook){showDefaultCopy();_params.ajaxGetProvince=ajaxGetProvince;_params.isHasPassbook=isHasPassbook||'';_nodes.$form=$('#formAuthorperson');_setFormValidate();_bindEvent();uploadAction();_areaLinkage.regionalLinkage(_params.ajaxGetProvince);}
function uploadAction(){$('#inputImage').on('click',function(){var noUploadHeader=$("#noUploadHeader").val();if(noUploadHeader==1){_dialog.alert('距离上次头像审核不足7天，无法上传新头像');return;}
if(noUploadHeader==2){_dialog.alert('图像审核中，无法上传新头像');return;}
$('#selectImage input').trigger('click');});}
function showDefaultCopy(){
$('#saveBtn').click(function(){
if($address.val()==str){
    $address.attr('style',_blackColor).val('');
    return false;}
});
$address.blur(function(){if($address.val()=='')
$address.val(str).attr('style',_grayColor);else
$address.attr('style',_blackColor);});$address.click(function(){if($address.val()==str){$address.val('').attr('style',_blackColor);}});}
function _bindEventBySelector(){var $citySelect=$('#citySelect');var $areaSelect=$('#areaSelect');$('#provinceSelect').on('change',function(){var provinceName=$(this).val(),cityNameList=_params.ajaxGetProvince[provinceName];if(cityNameList){var arrCityTpl=[];$.each(cityNameList,function(index,item){arrCityTpl.push('<option value="'+index+'">'+index+'</option>');});$citySelect.html(arrCityTpl.join(''));var arrCityTpl=[];$.each(cityNameList[$('#citySelect').val()],function(index,item){arrCityTpl.push('<option value="'+item+'">'+item+'</option>');});$areaSelect.html(arrCityTpl.join(''));}});$('#citySelect').change(function(){var cityName=$(this).val(),provinceName=$('#provinceSelect').val(),cityNameList=_params.ajaxGetProvince[provinceName];if(cityNameList){var arrCityTpl=[];$.each(cityNameList[$('#citySelect').val()],function(index,item){arrCityTpl.push('<option value="'+item+'">'+item+'</option>');});$areaSelect.html(arrCityTpl.join(''));}});}
function _bindEvent(){var $saveBtn=$('#saveBtn');$('#modifyBtn').on('click',function(){
$('.saveBox').hide();
$('.modifyBox').show();
$(this).hide();
$saveBtn.show();
if($address.val()=='')
$address.attr('style',_grayColor).val(str);

return false;});$saveBtn.on('click',function(){
_submitForm();return false;});
_tipAuthornameSuffix();
$("#provinceSelect1").change(function(){getCity();});$("#citySelect1").change(function(){getArea();});}
function _tipAuthornameSuffix()
{if(!$("#authorizeTypeBtn"))
{return;}
$("#authorizeTypeBtn").hover(function(){$("#authorizeTypeTips").show();},function(){$("#authorizeTypeTips").hide();});}
function _submitForm(){var $form=_nodes.$form;if(!$form.valid()){return;}
                       if(_isSubmitting){return;}
                       _isSubmitting=1;
$.ajax({
                                                     url:"/jpbook/users/upWriter",
                                                     data:$("#formAuthorperson").serialize(),
                                                     type:"post",
                                                     success:function (data) {
                                                        $('.saveBox').show();
                                                        $('.modifyBox').hide();
                                                        $("#saveBtn").hide();
                                                        $("#modifyBtn").show();
                                                        alert("修改成功");
                                                        window.location.reload();
                                                     }
                                                 });return;}
function _setFormValidate(){jQuery.validator.addMethod("realNameCheck",function(value,element){return this.optional(element)||/^[A-Za-z\u4E00-\u9FFF·\u4dae]{2,10}$/.test(value);},"2-10个汉字、数字或英文字母组成");jQuery.validator.addMethod("stringCheck",function(value,element){return this.optional(element)||/^[\u0391-\uFFE5·\u4dae\w]+$/.test(value);},"只能包括中文字、英文字母、数字和下划线");var rules={realname:{required:true,realNameCheck:true},idcard:{required:true,isIDCardV2:true,isIDCardV3:"#cardType"},mobile:{required:true,phoneCheck:"#tel_pre"},email:{required:true,email:true},qqid:{required:true,isQQ:true},address:{required:true,stringCheck:true,byteRangeLength:[10,128]}},messages={realname:{required:"真实姓名不能为空",realNameCheck:"真实姓名请使用2-10位汉字或英文"},idcard:{required:"请输入您的证件号码",isIDCardV2:"证件号码为8位以上并且不能超过18位。",isIDCardV3:"身份证号只支持18位"},mobile:{required:'请输入手机号码',phoneCheck:"请输入一个格式正确的手机号码"},email:{required:'请输入电子邮件',email:"请输入一个格式正确的电子邮件"},qqid:{required:'请输入QQ号',isQQ:"请输入一个格式正确的QQ号"},address:{required:'请输入详细地址',stringCheck:"地址只能包括中文字、英文字母、数字和下划线",byteRangeLength:"地址必须在5-64个字之内"}};var $authorNameInput=$('#authorNameInput');if($authorNameInput.length>0){jQuery.validator.addMethod("authorNameCheck",function(value,element){return this.optional(element)||/^[A-Za-z0-9\u4E00-\u9FFF.·\u4dae]{2,6}$/.test(value);},"2-6个汉字、数字或英文字母组成");rules.pen={required:true,authorNameCheck:true,remote:{url:_ajaxUrls.checkAuthorName,type:"post",data:{penn:function(){return $authorNameInput.val();}}}};messages.pen={required:"笔名不能为空",remote:'笔名已经存在，换个别的吧'};}
_nodes.$form.validate({'rules':rules,'messages':messages,errorElement:'span',errorPlacement:function(error,element){element.nextAll('[data-node="error"]').html(error).show();element.nextAll('[data-node="ok"]').hide();},success:function(error){var $ok=error.parent().prevAll('[data-node="ok"]');if(error.parent().parent().has('#authorNameInput')){if(_params.isHasPassbook==1)
{$ok.find('[data-node="text"]').text('笔名修改后需提交审核，2个工作日内完成');}
else
{$ok.find('[data-node="text"]').text('笔名可用');}}
$ok.show();error.remove();}});}
_util.initNameSpace("CS.page.personal");CS.page.personal.baseInfo={'init':init};})(jQuery);(function($){var _util=CS.util,_dialog=CS.dialog;window.ShearPhoto=function(){this.transform=this.DomMoveEve=this.DomUpEve=this.MoveDivEve=this.zoomEve=this.eveMold=false;this.DivDownEVe={};this.transformFun();!this.addevent&&window.addEventListener?(this.addevent="add",this.selectionempty=function(){window.getSelection().removeAllRanges();}):(this.addevent="att",this.selectionempty=function(){document.selection.empty();});this.MyAjax=new window.ShearPhoto.MyAjax();};window.ShearPhoto.prototype={transformFun:function(){var Imgstyle=document.body.style,arr=new Array("MsTransform","MozTransform","WebkitTransform","WebkitTransform","OTransform","transform");for(var i=0;i<arr.length;i++){if(arr[i]in Imgstyle){this.transform=arr[i];break;}}},HTML5:{Reg:new RegExp("translate3d\\((.*?)\\)","i"),HTML5LT:function(Transform){if(Transform){this.getLT=function(dom){domstyleTransform=this.Reg.exec(dom.style[Transform]);if(domstyleTransform){return domstyleTransform[1].split(",",2);}else{return[0,0];}};this.setLT=function(dom,L,T){var domstyle=dom.style,RegTrue=true,domstyleTransform=domstyle[Transform],txt="translate3d("+L+","+T+",0)",str=domstyleTransform.replace(this.Reg,function(a){RegTrue=false;return txt;});domstyle[Transform]=RegTrue?domstyleTransform+" "+txt:str;};this.setL=function(dom,L){var domstyle=dom.style,RegTrue=true,domstyleTransform=domstyle[Transform],str=domstyleTransform.replace(this.Reg,function(a,b){RegTrue=false;var T=b.split(",",2)[1];return"translate3d("+L+","+T+",0)";});domstyle[Transform]=RegTrue?domstyleTransform+" "+"translate3d("+L+",0,0)":str;};this.setT=function(dom,T){var domstyle=dom.style,RegTrue=true,domstyleTransform=domstyle[Transform],str=domstyleTransform.replace(this.Reg,function(a,b){RegTrue=false;var L=b.split(",",2)[0];return"translate3d("+L+","+T+",0)";});domstyle[Transform]=RegTrue?domstyleTransform+" "+"translate3d(0,"+T+",0)":str;};}else{this.getLT=function(dom){var domstyle=dom.style;return[domstyle.left||0,domstyle.top||0];};this.setLT=function(dom,L,T){var domstyle=dom.style;domstyle.left=L,domstyle.top=T;};this.setL=function(dom,L){dom.style.left=L;};this.setT=function(dom,T){dom.style.top=T;};}},URL:window.URL||window.webkitURL||window.mozURL||window.msURL||false,canvas:false,Images:false,ImagesType:"image/jpeg",HTML5PHP:false,HTML5MAX:false,HandleRotation:function(this_,MyR,SendArry,newcanvas,ctx,p,W,H){var ImgH=this_.ImgOHeight,ImgW=this_.ImgOWidth,ImgRW,ImgRH,ImgslateX,ImgslateY,MyRR,imgData,arrIMGWH=[Math.ceil(ImgW*p),Math.ceil(ImgH*p)];switch(MyR){case 90:ImgRW=arrIMGWH[1];ImgRH=arrIMGWH[0];ImgslateX=0;ImgslateY=ImgRH;break;case 180:ImgRW=arrIMGWH[0];ImgRH=arrIMGWH[1];ImgslateX=ImgRW;ImgslateY=ImgRH;break;case 270:ImgRW=arrIMGWH[1];ImgRH=arrIMGWH[0];ImgslateX=ImgRW;ImgslateY=0;break;}
newcanvas.width=ImgRW;newcanvas.height=ImgRH;ctx.translate(ImgslateX,ImgslateY);ctx.rotate((360-MyR)*Math.PI/180);ctx.drawImage(this_.arg.ImgMain,0,0,ImgW,ImgH,0,0,arrIMGWH[0],arrIMGWH[1]);imgData=ctx.getImageData(0,0,ImgRW,ImgRH);ctx.clearRect(0,0,arrIMGWH[0],arrIMGWH[1]);ctx.fillStyle="#FFFFFF";ctx.fillRect(0,0,arrIMGWH[0],arrIMGWH[1]);newcanvas.width=SendArry.IW=W;newcanvas.height=SendArry.IH=H;ctx.putImageData(imgData,-SendArry.X*p,-SendArry.Y*p);delete imgData;},zipImg:function(DataUrl,maxs,type,functions){var Image64=new Image(),this_=this;Image64.onload=function(){var newcanvas=document.createElement("canvas");newcanvas.style.display="none";var bodys=document.body;bodys.appendChild(newcanvas);var ctx=newcanvas.getContext("2d"),width=this.width,height=this.height;if(maxs){var P=width/height;if(width>maxs[0]){width=maxs[0];height=Math.round(maxs[0]/P);}
if(height>maxs[0]){height=maxs[0];width=Math.round(maxs[0]*P);if(width>maxs[0]){width=maxs[0];height=Math.round(maxs[0]/P);}}}
newcanvas.width=width;newcanvas.height=height;ctx.fillStyle="#FFFFFF";ctx.fillRect(0,0,width,height);ctx.drawImage(Image64,0,0,this.width,this.height,0,0,width,height);var DATA64=newcanvas.toDataURL(type,maxs?maxs[1]:.85);if(this_.URL){this_.BOLBID&&this_.URL.revokeObjectURL(this_.BOLBID);this_.BOLBID=this_.URL.createObjectURL(this_.FormBlob(DATA64));typeof functions==="function"&&functions(this_.BOLBID);}else{typeof functions==="function"&&functions(DATA64);}
ctx.clearRect(0,0,width,height);bodys.removeChild(newcanvas);delete DATA64;delete Image64;};Image64.src=DataUrl;delete DataUrl;},CtxDrawImage:function(ctx,SendArry,newcanvas,this_){var MyR=SendArry.R,arg=this_.arg;if(this.HTML5MAX){var W=SendArry.IW,WW=W,H=SendArry.IH,p=W/H;W>this.HTML5MAX?(W=this.HTML5MAX,H=Math.round(W/p),H>this.HTML5MAX&&(H=this.HTML5MAX,W=Math.round(H*p))):H>this.HTML5MAX&&(H=this.HTML5MAX,W=Math.round(H*p),W>this.HTML5MAX&&(W=this.HTML5MAX,H=Math.round(W/p)));p=W/WW;if(MyR===0){var twx=this_.ImgOWidth-SendArry.X,twy=this_.ImgOHeight-SendArry.Y,IMGWx=twx*p,IMGHy=twy*p;newcanvas.width=SendArry.IW=W;newcanvas.height=SendArry.IH=H;ctx.fillStyle="#FFFFFF";ctx.fillRect(0,0,IMGWx,IMGHy);ctx.drawImage(arg.ImgMain,SendArry.X,SendArry.Y,twx,twy,0,0,IMGWx,IMGHy);}else{this.HandleRotation(this_,MyR,SendArry,newcanvas,ctx,p,W,H);}}else{if(MyR===0){newcanvas.width=SendArry.IW;newcanvas.height=SendArry.IH;ctx.fillStyle="#FFFFFF";ctx.fillRect(0,0,SendArry.IW,SendArry.IH);ctx.drawImage(arg.ImgMain,-SendArry.X,-SendArry.Y);}else{this.HandleRotation(this_,MyR,SendArry,newcanvas,ctx,1,SendArry.IW,SendArry.IH);}}},lock:false,PhotoHTML5True:false,SetSrc:function(newsrc,ImgMain,ImgDom,domimg){ImgMain.src=ImgDom.src=newsrc;for(var i=0;i<domimg[1];i++){domimg[0][i].src=newsrc;}
delete newsrc;},BOLBID:false,Aclick:false,artwork:false,EffectsReturn:function(){this.Aclick&&(this.Aclick.className="");this.Aclick=this.artwork;this.artwork&&(this.artwork.className="Aclick");},Effects:function(StrEvent,HTML5){var ImgMain=this.arg.ImgMain,ImgDom=this.arg.ImgDom,AP;var preview=this.preview;var this_=this;return function(){if(HTML5.lock)
return;if(HTML5.Aclick===this){this_.pointhandle(1500,1,"亲！现在已经是"+StrEvent+"效果了",2,"#307ff6","#fff");return;}
HTML5.lock=true;AP=window.ShearPhoto.psLib(HTML5.Images);HTML5.Aclick&&(HTML5.Aclick.className="");HTML5.Aclick=this;this.className="Aclick";this_.pointhandle(0,1,"正在加载"+StrEvent+"效果！稍等....，不要动鼠标，可能有点卡",2,"#fbeb61","#3a414c",function(){setTimeout(function(){var domimg=preview.domimg,DATA64;if(StrEvent==="原图"){DATA64=AP.save(false,HTML5.ImagesType);}else{DATA64=AP.ps(StrEvent).save(false,HTML5.ImagesType);}
if(HTML5.URL){HTML5.BOLBID&&HTML5.URL.revokeObjectURL(HTML5.BOLBID);HTML5.BOLBID=HTML5.URL.createObjectURL(HTML5.FormBlob(DATA64));HTML5.SetSrc(HTML5.BOLBID,ImgMain,ImgDom,domimg);this_.runImgUrl=[HTML5.BOLBID,true,true];}else{HTML5.SetSrc(DATA64,ImgMain,ImgDom,domimg);this_.runImgUrl=[DATA64,true,true];}
delete DATA64;this_.pointhandle(1500,1,StrEvent+"效果加载成功！提示：如果机器配置差，效果加载时间会更长哦",1,"#307ff6","#fff");HTML5.lock=false;HTML5.PhotoHTML5True=true;},1);});};},BlobRegExp:new RegExp("^data:.*base64,"),FormBlob:function(dataURI){var byteString,splits=false,splits1=dataURI.replace(this.BlobRegExp,function(){splits=true;return"";});if(splits)
byteString=atob(splits1);else
byteString=unescape(splits1);var byteStringlength=byteString.length,ia=new Uint8Array(byteStringlength);for(var i=0;i<byteStringlength;i++){ia[i]=byteString.charCodeAt(i);}
return new Blob([ia],{type:this.ImagesType});},IfHTML5:function(transform,H5True,HTML5MAX){try{new Blob(["1"],{type:"text/plain"});}catch(e){H5True=false;}
transform&&H5True&&(this.canvas=true,this.HTML5MAX=HTML5MAX);},CanvasImg:function(SendArry,postArgs,this_){var newcanvas=document.createElement("canvas"),bodys=document.body;newcanvas.style.display="none";bodys.appendChild(newcanvas);var ctx=newcanvas.getContext("2d");this.CtxDrawImage(ctx,SendArry,newcanvas,this_);var blob=this.FormBlob(newcanvas.toDataURL(this.ImagesType,this_.arg.HTML5Quality));ctx.clearRect(0,0,SendArry.IW,SendArry.IH);bodys.removeChild(newcanvas);var readerForm=new FormData();readerForm.append("ShearPhotoIW",SendArry.IW);readerForm.append("ShearPhotoIH",SendArry.IH);readerForm.append("ShearPhotoFW",SendArry.FW);readerForm.append("ShearPhotoFH",SendArry.FH);readerForm.append('_token',$.cookie('pubtoken'));readerForm.append("ShearPhotoP",this_.arg.proportional[0]);if(Object.prototype.toString.call(postArgs)==="[object Object]"){for(var key in postArgs){readerForm.append(key,postArgs[key]);}}
readerForm.append("UpFile",blob);return readerForm;}},_ieexchange_:function(){var this_=this;function e(a,b){var exchange=new Array(this_[a],this_[b]);this_[a]=exchange[1];this_[b]=exchange[0];}
e("ImgWidth","ImgHeight");},SetRote:{ROReg:new RegExp("rotate\\((.*?)\\)","i"),SLReg:new RegExp("translate\\((.*?)\\)","i"),run:function(DOM,Transform,RO,SL){var domstyle=DOM.style,RegTrue=true,domstyleTransform=domstyle[Transform],ROstr=domstyleTransform.replace(this.ROReg,function(){RegTrue=false;return RO;}),txt=RegTrue?domstyleTransform+" "+RO:ROstr,RegTrue=true,SLstr=txt.replace(this.SLReg,function(){RegTrue=false;return SL;}),txt=RegTrue?txt+" "+SL:SLstr;return txt;},runSL:function(DOM,Transform,SL){var domstyle=DOM.style,RegTrue=true,domstyleTransform=domstyle[Transform],SLstr=domstyleTransform.replace(this.SLReg,function(){RegTrue=false;return SL;});return RegTrue?domstyleTransform+" "+SL:SLstr;}},_exchange_:function(){var this_=this;this._ieexchange_();var IfRotate=this.rotate;if(IfRotate===90||IfRotate===270){var consts={90:-1,270:1}[IfRotate];this.ImgRotateFun=function(W,H){var ImgRotateLT=consts*Math.round((H-W)*.5)+"px",arg=this.arg,str="translate("+ImgRotateLT+","+ImgRotateLT+")";arg.ImgMain.style[this_.transform]=this_.SetRote.runSL(arg.ImgMain,this_.transform,str);arg.ImgDom.style[this_.transform]=this_.SetRote.runSL(arg.ImgDom,this_.transform,str);return[H,W];};return function(ImgMain,ImgDom,rotate){var slate=consts*Math.round((this_.ImgWidth-this_.ImgHeight)*.5),str="translate("+slate+"px,"+slate+"px)";ImgMain.style[this_.transform]=this_.SetRote.run(ImgMain,this_.transform,rotate,str);ImgDom.style[this_.transform]=this_.SetRote.run(ImgDom,this_.transform,rotate,str);return slate;};this.preview.WH=[this_.ImgHeight,this_.ImgWidth];}else{this.preview.WH=[this_.ImgWidth,this_.ImgHeight];this.ImgRotateFun=function(W,H){return[W,H];};return function(ImgMain,ImgDom,rotate){ImgMain.style[this_.transform]=this_.SetRote.run(ImgMain,this_.transform,rotate,"translate(0,0)");ImgDom.style[this_.transform]=this_.SetRote.run(ImgDom,this_.transform,rotate,"translate(0,0)");return 0;};}},preview:{isW:new Array(),isH:new Array(),run:function(arg,thisMain){var _this=this;if(Object.prototype.toString.call(arg.preview)==="[object Array]"){var leng=arg.preview.length,EmptyFun=function(){},srcDefault=arg.relativeUrl+"images/default.gif";if(leng>0){arg.scope.parentNode.insertAdjacentHTML("afterEnd",'<div id="preview" style="display:none;margin-left:8px;"></div>');var HTML="",proportionFun=EmptyFun,p=false;arg.proportional[0]?p=arg.proportional[0]:proportionFun=function(d,w,i,pro){d[1][i].style.height=Math.round(w[i]/pro[0]*pro[1])+"px";};var margin_right=10,borderW=5,MBall=margin_right+borderW*2;for(var i=0;i<leng;i++){this.domWidth+=arg.preview[i]+MBall;HTML+='<a href="javascript:;" style="width:'+arg.preview[i]+"px;height:"+(p?Math.round(arg.preview[i]/p)+"px;":"auto;")+"margin-right:"+margin_right+"px;background-color: #F5F5F5;border: "+borderW+"px solid #F5F5F5;"+'"><img src="'+srcDefault+'"/></a>';}
this.dom=document.getElementById("preview");this.dom.innerHTML=HTML;this.dom.parentNode.style.width=arg.scopeWidth+2+"px";var domimg=[this.dom.getElementsByTagName("img"),this.dom.getElementsByTagName("a")],imgUrlFun=function(d,u){d.src=u;},imgWHFun=function(d,WH,pro,i){var W=Math.round(WH[0]*pro),H=Math.round(WH[1]*pro),True=false;_this.isW[i]===W||(d.style.width=W+"px",_this.isW[i]=W,True=true);_this.isH[i]===H||(d.style.height=H+"px",_this.isH[i]=H,True=true);if(True&&thisMain.rotate>10&&thisMain.rotate!==180){var mylt=(_this.isW[i]-_this.isH[i])/(thisMain.rotate===270?-2:2)+"px";d.style[thisMain.transform]=thisMain.SetRote.runSL(d,thisMain.transform,"translate("+mylt+","+mylt+")");}},RFun=function(d,styleR,R,pro){if(thisMain.transform){var SL=R[1]*pro+"px";d.style[styleR]=thisMain.SetRote.run(d,styleR,R[0],"translate("+SL+","+SL+")");}else{d.style[styleR]=R;}},funone,funtwo,funthree,domimgA=domimg[0],pro,leftBorder,topBorder,domimgi;this.domimg=[domimg[0],leng],this.close_=function(){for(var i=0;i<leng;i++){domimgi=domimgA[i];domimgi.src=srcDefault;if("cssText"in domimgi.style)
domimgi.style.cssText="";else
domimgi.setAttribute("style","");}
this.dom.style.display="none";arg.Effects&&(arg.Effects.style.display="none");this.dom.parentNode.style.width=arg.scopeWidth+2+"px";};this.SetPreview=function(p){if(p){for(var i=0;i<leng;i++)
domimg[1][i].style.height=Math.round(arg.preview[i]/p)+"px";proportionFun=EmptyFun;}else
proportionFun=function(d,w,i,pro){d[1][i].style.height=Math.round(w[i]/pro[0]*pro[1])+"px";};};this.handle=function(argarr,True,TrueHTML5,args){True&&this.open_(args||arg,TrueHTML5);var left=argarr.left,top=argarr.top,formAllW=argarr.formAllW,imgUrl=argarr.imgUrl,TF=argarr.TF,styleR=argarr.styleR,R=argarr.R,formAllH=argarr.formAllH,HTML3D=argarr.HTML3D;typeof imgUrl==="boolean"?funone=EmptyFun:funone=imgUrlFun;TF?funtwo=imgWHFun:funtwo=EmptyFun;typeof R==="boolean"?funthree=EmptyFun:funthree=RFun;typeof left==="boolean"?left=EmptyFun:(leftBorder=left+arg.Border,topBorder=top+arg.Border,left=function(pro){HTML3D.setLT(domimgi,Math.round(leftBorder*pro)+"px",Math.round(topBorder*pro)+"px");});for(var i=0;i<leng;i++){domimgi=domimgA[i];pro=arg.preview[i]/formAllW;left(pro);proportionFun(domimg,arg.preview,i,[formAllW,formAllH]);funone(domimgi,imgUrl);funtwo(domimgi,this.WH,pro,i);funthree(domimgi,styleR,R,pro);}};}}},dom:false,domWidth:0,domimg:false,WH:new Array(2),parentNodes:false,SetPreview:function(){},EffTrue:false,handle:function(argarr,True,arg){True&&this.open_(arg);},close_:function(){this.arg.Effects&&(this.arg.Effects.style.display="none");this.parentNodes&&(this.parentNodes.style.width=this.arg.scopeWidth+2+"px");},open_:function(arg){var efffwidth=0;this.arg=arg;if(this.EffTrue){arg.Effects.style.display="block";arg.Effects.scrollTop=0;arg.Effects.style.height=arg.scopeHeight+"px";this.parentNodes=arg.Effects.parentNode;efffwidth=arg.Effects.offsetWidth;}else{arg.Effects&&(arg.Effects.parentNode.removeChild(arg.Effects),arg.Effects=false);}
if(this.dom){var this_=this;this.dom.style.display="block";this.dom.parentNode.style.width=arg.scopeWidth+this.domWidth+efffwidth+10+"px";}else{arg.Effects&&(arg.Effects.parentNode.style.width=arg.scopeWidth+this.domWidth+efffwidth+2+"px");}}},Rotate:function(arg){var rotate;this.saveL=this.formLeft+this.relatL;this.saveT=this.formTop+this.relatT;if(this.transform){arg==="left"?this.rotate-=90:this.rotate+=90;this.rotate={"-90":270,0:0,"-270":90,360:0,180:180,90:90,270:270,"-360":0,"-180":180}[this.rotate]||0;rotate="rotate("+this.rotate+"deg)";var fun=this._exchange_();this.setinitial(this.arg,true);var SL=fun(this.arg.ImgMain,this.arg.ImgDom,rotate);this.preview.handle({left:this.ImgDomL,top:this.ImgDomT,formAllW:this.formAllW,formAllH:this.formAllH,imgUrl:false,styleR:this.transform,R:[rotate,SL],HTML3D:this.HTML5});}else{arg==="left"?this.rotate-=1:this.rotate+=1;this.rotate=this.rotate>3?0:this.rotate<0?3:this.rotate;if(this.rotate===1||this.rotate===3){this.ImgRotateFun=function(W,H){return[H,W];};}else{this.ImgRotateFun=function(W,H){return[W,H];};}
this.arg.ImgMain.style.filter=this.arg.ImgDom.style.filter=rotate="progid:DXImageTransform.Microsoft.BasicImage(rotation="+this.rotate+")";this._ieexchange_();this.preview.handle({left:false,top:false,formAllW:this.formAllW,formAllH:this.formAllH,imgUrl:false,styleR:"filter",R:rotate,HTML3D:this.HTML5});this.setinitial(this.arg,true);}},pointhandle:function(residencetime,speed,txt,Position,backgroundColor,color,functions){var point=this.arg.scope.children[0];point.className==="point"&&this.arg.scope.removeChild(point);if(residencetime===-1)
return;point=document.createElement("div");point.className="point";this.arg.scope.insertBefore(point,this.arg.scope.childNodes[0]);var this_=this,num=-35,HTML53D=this.HTML5;function show(begin,end,speed,cmd){begin+=cmd;if(begin>end&&0<cmd){HTML53D.setT(point,end+"px");if(residencetime){setTimeout(function(){show(end,num,speed,-1);},residencetime);}else{typeof functions==="function"&&functions();}
return;}else{if(end>begin&&0>cmd){try{this_.arg.scope.removeChild(point);}catch(e){}
return;}}
HTML53D.setT(point,begin+"px");setTimeout(function(){show(begin,end,speed,cmd);},speed);}
point.style.color=color;point.style.backgroundColor=backgroundColor;point.innerHTML="<i></i>"+txt;var pointI=point.getElementsByTagName("i")[0];switch(Position){case 0:pointI.style.backgroundPosition="-16px 0";break;case 1:pointI.style.backgroundPosition="0 0";break;case 2:pointI.style.backgroundPosition="-31px 0";break;}
show(num,0,speed,1);},setinitial:function(arg,TF){var cl=0,ct=0,TrueTraverse=!arg.traverse,HTML53D=this.HTML5,RL,BL,RT,BT;if(this.BoxW>this.ImgWidth){this.relatW=this.ImgWidth;arg.relat.style.width=this.ImgWidth+"px";var BiW=Math.round((this.BoxW-this.ImgWidth)*.5);RL=(this.relatL=BiW)+"px";BL=-BiW+"px";}else{arg.relat.style.width=this.BoxW+"px";this.relatW=this.BoxW;RL=BL=this.relatL=0;TrueTraverse&&(cl=(this.BoxW-this.ImgWidth)*.5);}
if(this.BoxH>this.ImgHeight){this.relatH=this.ImgHeight;arg.relat.style.height=this.ImgHeight+"px";var BiH=Math.round((this.BoxH-this.ImgHeight)*.5);this.relatT=BiH;RT=BiH+"px";BT=-BiH+"px";}else{this.relatH=this.BoxH;arg.relat.style.height=this.BoxH+"px";RT=BT=this.relatT=0;TrueTraverse&&(ct=(this.BoxH-this.ImgHeight)*.5);}
HTML53D.setLT(arg.relat,RL,RT);HTML53D.setLT(arg.black,BL,BT);this.AmendOffset();this.MovePhoto(TF,cl,ct,TrueTraverse);},MovePhoto:function(TF,cl,ct,True){var arg=this.arg,ImgDom=arg.ImgDom,ImgMain=arg.ImgMain,also,scale,ImgMainL,ImgMainT,ImgDomL,ImgDomT,HTML3D=this.HTML5;if(arg.traverse&&this.BoxW<this.ImgWidth){var MinusImgWBoxW=this.ImgWidth-this.BoxW;also=this.BoxW-this.formAllW;scale=also&&MinusImgWBoxW/also;var L=Math.round(-this.formLeft*scale);ImgMainL=L;ImgDomL=L-this.formLeft-this.Border;}else{ImgMainL=cl=arg.traverse?0:True?cl:this.ImgMainL;ImgDomL=cl-this.formLeft-this.Border;}
if(arg.traverse&&this.BoxH<this.ImgHeight){var MinusImgHBoxH=this.ImgHeight-this.BoxH;also=this.BoxH-this.formAllH;scale=also&&MinusImgHBoxH/also;var T=Math.round(-this.formTop*scale);ImgMainT=T;ImgDomT=T-this.formTop-this.Border;}else{ImgMainT=ct=arg.traverse?0:True?ct:this.ImgMainT;ImgDomT=ct-this.formTop-this.Border;}
this.ImgMainT=ImgMainT,this.ImgMainL=ImgMainL;this.ImgDomL=ImgDomL,this.ImgDomT=ImgDomT;HTML3D.setLT(ImgMain,ImgMainL+"px",ImgMainT+"px");HTML3D.setLT(ImgDom,ImgDomL+"px",ImgDomT+"px");this.preview.handle({left:ImgDomL,top:ImgDomT,formAllW:this.formAllW,formAllH:this.formAllH,imgUrl:false,TF:TF,styleR:false,R:false,HTML3D:HTML3D});},AmendOffset:function(){var HTML53D=this.HTML5,LT3D;if(this.saveL){this.formLeft=this.saveL-this.relatL;this.formTop=this.saveT-this.relatT;}else{LT3D=HTML53D.getLT(this.formParent);typeof this.formLeft==="boolean"&&(this.formLeft=parseFloat(LT3D[0]));typeof this.formTop==="boolean"&&(this.formTop=parseFloat(LT3D[1]));this.formLeft-=this.relatL;this.formTop-=this.relatT;}
this.formLeft<0&&(this.formLeft=0,this.saveL=this.relatL);this.formTop<0&&(this.formTop=0,this.saveT=this.relatT);var formWL=this.formLeft+this.formAllW,formHT=this.formTop+this.formAllH;if(formWL>this.relatW){var FrL=formWL-this.relatW;if(FrL>this.formLeft){this.formW=this.formW-(FrL-this.formLeft);this.formLeft=0;this.saveL=this.relatL;this.formAllW=this.formW+this.Mdouble;}else{this.formLeft-=FrL;this.saveL=this.formLeft+this.relatL;}}
if(formHT>this.relatH){var FrT=formHT-this.relatH;if(FrT>this.formTop){this.formH=this.formH-(FrT-this.formTop);this.formTop=0;this.saveT=this.relatT;this.formAllH=this.formH+this.Mdouble;}else{this.formTop-=FrT;this.saveT=this.formTop+this.relatT;}}
HTML53D.setLT(this.formParent,this.formLeft+"px",this.formTop+"px");if(this.arg.proportional[0]){var H=Math.round(this.formAllW/this.arg.proportional[0]);if(H>this.formAllH){this.formAllW=Math.round(this.formAllH*this.arg.proportional[0]);this.formW=this.formAllW-this.Mdouble;}else{this.formAllH=H;this.formH=H-this.Mdouble;}}
this.arg.form.style.width=this.formW+"px",this.arg.form.style.height=this.formH+"px";this.ie6(this.formParent,this.formAllW,this.formAllH);},MaxMinLimit:function(this_){this_.ImgWidth=this_.ImgOWidth=this.width;this_.ImgHeight=this_.ImgOHeight=this.height;if(typeof this_.arg.Max==="number"){this_.ImgWidth>this_.arg.Max&&(this_.ImgWidth=this_.arg.Max,this_.ImgHeight=Math.round(this_.ImgWidth/this_.ImgScales));this_.ImgHeight>this_.arg.Max&&(this_.ImgHeight=this_.arg.Max,this_.ImgWidth=Math.round(this_.ImgHeight*this_.ImgScales));}
var MH,MW;if(this_.arg.proportional[0]){MH=this_.Min;MW=Math.round(MH*this_.arg.proportional[0]);if(MW<this_.Min){MW=this_.Min;MH=Math.round(MW/this_.arg.proportional[0]);}}else{MW=MH=this_.Min;}
this_.ImgWidth<MW&&(this_.ImgWidth=MW,this_.ImgHeight=Math.round(this_.ImgWidth/this_.ImgScales));this_.ImgHeight<MH&&(this_.ImgHeight=MH,this_.ImgWidth=Math.round(this_.ImgHeight*this_.ImgScales));this_.artworkW=this_.ImgWidth,this_.artworkH=this_.ImgHeight;},SetProportional:function(pro){if(pro!=this.arg.proportional[0]){this.arg.proportional[0]=pro;if(!this.runImgUrl){return;}
var Type=this.HTML5.ImagesType,this_=this,runImgUrl=this.runImgUrl;this.preview.close_();this.pointhandle(0,1,"正在更换截框比例......",2,"#fbeb61","#3a414c",function(){this_.again();this_.run.apply(this_,runImgUrl);this_.HTML5.ImagesType=Type;this_.preview.SetPreview(pro);});}},run:function(ImgUrl,Trues,SetPro){this.runImgUrl=[ImgUrl,Trues,true];this.HTML5.HTML5PHP=Trues;var this_=this,arg=this.arg,relatImgUrl=this.HTML5.canvas&&Trues?ImgUrl:arg.relativeUrl+ImgUrl,image=new Image();SetPro||(this.HTML5.Images=image);this.defaultShear();this.arg=arg;this.HTML5.canvas&&Trues||(this.ImgUrl=ImgUrl);image.onload=function(){if(!(this.width=Math.round(this.width))>0||!(this.height=Math.round(this.height))>0){this_.pointhandle(3e3,10,"请选择正确图片",0,"#f82373","#fff");return;}
arg.ImgMain.src=arg.ImgDom.src=relatImgUrl;arg.black.style.zIndex=99;this_.ImgScales=this.width/this.height;this_.Min=arg.Min;this_.MaxMinLimit.call(this,this_);arg.ImgMain.style.width=arg.ImgDom.style.width=this_.artworkW+"px",arg.ImgMain.style.height=arg.ImgDom.style.height=this_.artworkH+"px";this_.BoxW=arg.scope.offsetWidth-2;this_.BoxH=arg.scope.offsetHeight-2;this_.Border=arg.Border;this_.Mdouble=arg.Border*2;var W,H;if(arg.proportional[0]){W=arg.proportional[1]-this_.Mdouble;H=arg.proportional[1]/arg.proportional[0]-this_.Mdouble;}else{W=arg.proportional[1]-this_.Mdouble;H=arg.proportional[2]-this_.Mdouble;}
this_.formW=W=Math.round(W);this_.formH=H=Math.round(H);this_.formAllW=W+this_.Mdouble;this_.formAllH=H+this_.Mdouble;this_.preview.WH=[this_.artworkW,this_.artworkH];this_.formParent=arg.form.offsetParent;this_.et();this_.setinitial(arg);this_.preview.handle({left:false,top:false,formAllW:this_.formAllW,formAllH:this_.formAllH,TF:true,imgUrl:relatImgUrl,styleR:false,R:false,HTML3D:this_.HTML5},true,arg);var str=this_.MoveDiv=new window.ShearPhoto.MoveDiv();str.reckon(arg.relat,false);str.selectionempty=this_.selectionempty;str.addevent=this_.addevent;str.HTML5=this_.HTML5;str.run({to:new Array(arg.form),form:this_.formParent,MoveWidth:this_.relatW,MoveHeight:this_.relatH,shifting:new Array(),center:1,centerFront:function(){return[this_.relatW,this_.relatH];},DivDownFun:function(t){t.arg.MoveWidth=this_.relatW;t.arg.MoveHeight=this_.relatH;t.DivW=this_.formW+this_.Mdouble;t.DivH=this_.formH+this_.Mdouble;},centerfun:function(l,t,tt){this_.formLeft=l;this_.formTop=t;this_.MovePhoto(false,0,0);tt.arg.MoveWidth=this_.relatW;tt.arg.MoveHeight=this_.relatH;tt.DivW=this_.formW+this_.Mdouble;tt.DivH=this_.formH+this_.Mdouble;},zIndex:100,MoveFun:function(iL,iT,MoveScale){this_.formLeft=iL;this_.formTop=iT;this_.MovePhoto(true,0,0);}});this_.MoveDivEve=function(){str.delDownEve();};arg.Shearbar.style.display="block";arg.SelectBox.style.visibility="hidden";this_.zoom();this_.pointhandle(2e3,10,"可以拖动或拉伸蓝边框进行截图",1,"#fbeb61","#3a414c");$('#saveShear').show();delete relatImgUrl;delete ImgUrl;};image.onerror=function(){this_.pointhandle(0,10,"无法读取图片。图片类型或路径不正确 或 relativeUrl参数是否存在问题",0,"#f82373","#fff");};this.pointhandle(0,1,"图片已加载，正在截图，请稍后...",2,"#fbeb61","#3a414c",function(){image.src=relatImgUrl;});},config:function(arg){this.arg=arg;arg.scope.style.width=arg.black.style.width=arg.SelectBox.style.width=arg.scopeWidth+"px";arg.scope.style.height=arg.black.style.height=arg.SelectBox.style.height=arg.scopeHeight+"px";var scopeparentNode=arg.scope.parentNode;scopeparentNode.style.width=scopeparentNode.parentNode.style.width=arg.scopeWidth+2+"px";var opacityFun;this.HTML5.IfHTML5(this.transform,arg.HTML5,arg.HTML5MAX);this.HTML5.HTML5LT(arg.translate3d&&this.transform);if(this.transform)
opacityFun=function(t,n){t.style.opacity=n;};else
opacityFun=function(t,n){t.style.filter="alpha(opacity="+n*100+")";};if(arg.Border>0){arg.DynamicBorder[0].style.display=arg.DynamicBorder[1].style.display=arg.DynamicBorder[2].style.display=arg.DynamicBorder[3].style.display="none";arg.DynamicBorder[0].style.background=arg.DynamicBorder[1].style.background=arg.DynamicBorder[2].style.background=arg.DynamicBorder[3].style.background="#FFF";for(var a in arg.to){arg.to[a].style.border="1px solid"+" "+arg.BorderColor;arg.to[a].style.background=arg.BorderColor;opacityFun(arg.to[a],1);}
arg.form.style.border=arg.Border+"px"+"  "+arg.BorderStyle+"  "+arg.BorderColor;}
arg.black.style.background=arg.backgroundColor;opacityFun(arg.black,arg.backgroundOpacity);this.preview.run(arg,this);arg.scope.ondragstart=function(){return false;};if(navigator.userAgent.indexOf("MSIE 6.0")>0&&arg.Border===0)
this.ie6=function(a,b,c){a.style.height=arg.DynamicBorder[1].style.height=arg.DynamicBorder[2].style.height=c+"px";a.style.width=b+"px";};else
this.ie6=function(){};if(this.preview.EffTrue=arg.HTML5Effects&&this.HTML5.canvas&&arg.Effects){var EffectsA=arg.Effects.getElementsByTagName("a"),EffectsAi,EffectsAiclick=this.HTML5.Effects;this.HTML5.artwork=this.HTML5.Aclick=EffectsA[0];for(var i=0;i<EffectsA.length;i++){EffectsAi=EffectsA[i];EffectsAi.onclick=EffectsAiclick.call(this,EffectsAi.getAttribute("StrEvent"),this.HTML5);}}
this.pointhandle(3e3,10,"请选择本地照片、相册、拍照，进行截取头像",2,"#307ff6","#fff");},zoom:function(){var this_=this,zoom=new window.ShearPhoto.MoveDiv();zoom.reckon(this_.arg.ZoomDist,false);zoom.selectionempty=this_.selectionempty;zoom.addevent=this_.addevent;zoom.HTML5=this.HTML5;var Draggable=this_.arg.ZoomBar,MH,MW,thePro;function SetMHW(PRO){if(PRO){MH=this_.Min;MW=Math.round(MH*PRO);if(MW<this_.Min){MW=this_.Min;MH=Math.round(MW/PRO);}}else{MW=MH=this_.Min;}}
SetMHW(this_.arg.proportional[0]);zoom.run({to:[Draggable],form:Draggable,MoveWidth:zoom.ReckonWH.W,MoveHeight:zoom.ReckonWH.H,shifting:new Array(),center:1,zIndex:100,DivDownFun:function(){this_.saveL=this_.formLeft+this_.relatL;this_.saveT=this_.formTop+this_.relatT;},cursor:"pointer",MoveFun:function(L){var schedule;if(L<bisect)
schedule=Math.round(Zoomout*L+10)/100;else
schedule=Math.round(L*magnify-100)/100;var W=Math.round(this_.artworkW*schedule),H=Math.round(this_.artworkH*schedule);W<MW&&(W=MW,H=Math.round(W/this_.ImgScales));H<MH&&(H=MH,W=Math.round(H*this_.ImgScales));var IMGWH=this_.ImgRotateFun(W,H);this_.ImgWidth=IMGWH[0];this_.ImgHeight=IMGWH[1];this_.arg.ImgMain.style.width=this_.arg.ImgDom.style.width=W+"px";this_.arg.ImgMain.style.height=this_.arg.ImgDom.style.height=H+"px";this_.preview.WH=[W,H];this_.setinitial(this_.arg,true);}});this_.zoomEve=function(){zoom.delDownEve();};var zoomMAx=zoom.ReckonWH.W-zoom.DivW,bisect=zoomMAx*.5,magnify=200/bisect,Zoomout=90/bisect;},PointerShape:function(Shape){this.arg.scope.style.cursor=this.arg.form.style.cursor=Shape;},DelPointerShape:function(){this.arg.scope.style.cursor="";this.arg.form.style.cursor="move";},ShearPhotoDown:function(obj,fun){this.addEvent(obj,"mousedown",fun);this.addEvent(obj,"touchstart",fun);},delShearPhotoDown:function(obj,fun){this.delEvent(obj,"mousedown",fun);this.delEvent(obj,"touchstart",fun);},et:function(){for(var a in this.arg.to){if(this.addevent==="add"){if(typeof this.DivDownEVe[a]!=="function"){this.DivDownEVe[a]=this.DivDown(a);}else{this.delShearPhotoDown(this.arg.to[a],this.DivDownEVe[a]);}
this.ShearPhotoDown(this.arg.to[a],this.DivDownEVe[a]);}else{this.arg.to[a].onmousedown=this.DivDown(a);}}},addEvent:function(obj,evetype,fun){var addevent={add:function(){obj.addEventListener(evetype,fun,false);},att:function(){obj.attachEvent("on"+evetype,fun);}};addevent[this.addevent]&&addevent[this.addevent]();},delEvent:function(obj,evetype,fun){var delevent={add:function(){obj.removeEventListener(evetype,fun,false);},att:function(){obj.detachEvent("on"+evetype,fun);}};delevent[this.addevent]&&delevent[this.addevent]();},DomUp:function(dom){var this_=this;return function(){typeof this_.arg.UpFun==="function"&&this_.arg.UpFun();dom.releaseCapture&&dom.releaseCapture();this_.DelPointerShape();typeof this_.DomMoveEve==="function"&&this_.delEvent(document,this_.eveMold[1],this_.DomMoveEve);if(typeof this_.DomUpEve==="function"){this_.delEvent(document,this_.eveMold[2],this_.DomUpEve);this_.delEvent(window,this_.eveMold[2],this_.DomUpEve);this_.delEvent(window,"blur",this_.DomUpEve);this_.delEvent(dom,"losecapture",this_.DomUpEve);}
return false;};},setWHfalse:function(argform,iW,iH,proportional,MaxW,MaxH){iW>MaxW&&(iW=MaxW);iH>MaxH&&(iH=MaxH);iW<this.Min&&(iW=this.Min);iH<this.Min&&(iH=this.Min);return[iW,iH];},setWfalse:function(argform,iW,iH,proportional,MaxW,MaxH){iW>MaxW&&(iW=MaxW);iW<this.Min&&(iW=this.Min);return[iW,this.formAllH];},setHfalse:function(argform,iW,iH,proportional,MaxW,MaxH){iH>MaxH&&(iH=MaxH);iH<this.Min&&(iH=this.Min);return[this.formAllW,iH];},CycleCalculation:function(iW,iH,proportional,MaxW,MaxH){if(iH>MaxH){iH=MaxH;iW=Math.round(iH*proportional);return this.CycleCalculation.apply(this,arguments);}
if(iW>MaxW){iW=MaxW;iH=Math.round(iW/proportional);return this.CycleCalculation.apply(this,arguments);}
if(iH<this.Min){iH=this.Min;iW=Math.round(iH*proportional);return this.CycleCalculation.apply(this,arguments);}
if(iW<this.Min){iW=this.Min;iH=Math.round(iW/proportional);return this.CycleCalculation.apply(this,arguments);}
return[iW,iH];},setHtrue:function(argform,iW,iH,proportional,MaxW,MaxH){iW=Math.round(iH*proportional);return this.CycleCalculation(iW,iH,proportional,MaxW,MaxH);},setWtrue:function(argform,iW,iH,proportional,MaxW,MaxH){iH=Math.round(iW/proportional);return this.CycleCalculation(iW,iH,proportional,MaxW,MaxH);},amend:function(iW,iH,formParent,strLL,strTT){var L=iW-this.formAllW,T=iH-this.formAllH,Left,Top,ImgLeft,ImgTop,this_=this,HTML5=this.HTML5,fun={LL:function(){Left=Math.round(this_.formLeft-L);this_.formLeft=Left;HTML5.setL(formParent,Left+"px");},TT:function(){Top=Math.round(this_.formTop-T);this_.formTop=Top;HTML5.setT(formParent,Top+"px");},ML:function(){L*=.5;Left=this_.formLeft-L;this_.formLeft=Left;HTML5.setL(formParent,Left+"px");},MT:function(){T*=.5;Top=this_.formTop-T;this_.formTop=Top;HTML5.setT(formParent,Top+"px");},NO:function(){}};fun[strLL](),fun[strTT]();},DomMove:function(this_,dom,disX,disY,PNW,PNH,formParent,MaxW,MaxH,strLL,strTT){var eveclientX,eveclientY,drawWH,iW,iH,argform,iHH,iWW,ImgMain=this_.arg.ImgMain,ImgDom=this_.arg.ImgDom;if(typeof this_.DomUpEve==="function"){this_.delEvent(document,this_.eveMold[2],this_.DomUpEve);this_.delEvent(window,this_.eveMold[2],this_.DomUpEve);this_.delEvent(window,"blur",this_.DomUpEve);this_.delEvent(dom,"losecapture",this_.DomUpEve);}
this_.DomUpEve=this_.DomUp(dom);this_.addEvent(document,this_.eveMold[2],this_.DomUpEve);this_.addEvent(window,this_.eveMold[2],this_.DomUpEve);this_.addEvent(window,"blur",this_.DomUpEve);this_.addEvent(dom,"losecapture",this_.DomUpEve);return function(eve){eve=eve||window.event;if(eve.button>1){this_.DomUp(this)();return false;}
eveclientX=this_.eveMold[3](eve,"clientX"),eveclientY=this_.eveMold[3](eve,"clientY"),argform=this_.arg.form;setTimeout(function(){iW=PNW*(eveclientX-disX);iH=PNH*(eveclientY-disY);this_.selectionempty();drawWH=this_.drawfun(argform,iW,iH,this_.arg.proportional[0],MaxW,MaxH);iW=drawWH[0];iH=drawWH[1];this_.amend(iW,iH,formParent,strLL,strTT);this_.formAllW=iW;this_.formAllH=iH;iW=this_.formW=iW-this_.Mdouble;iH=this_.formH=iH-this_.Mdouble;argform.style.width=iW+"px",argform.style.height=iH+"px";this_.ie6(formParent,iW,iH);this_.MovePhoto(true,0,0);},1);return false;};},defaultShear:function(){typeof this.MoveDivEve==="function"&&this.MoveDivEve();typeof this.zoomEve==="function"&&this.zoomEve();if("cssText"in this.arg.ImgMain.style)
this.arg.ImgMain.style.cssText=this.arg.ImgDom.style.cssText="";else{this.arg.ImgMain.setAttribute("style","");this.arg.ImgDom.setAttribute("style","");}
this.arg=this.ImgUrl=this.formW=this.formH=this.formAllW=this.formAllH=this.drawfun=this.formParent=this.ImgWidth=this.ImgHeight=this.artworkW=this.artworkH=this.BoxW=this.BoxH=this.Border=this.Mdouble=this.ImgScales=this.Min=this.formLeft=this.formTop=this.relatL=this.relatT=this.relatW=this.relatH=this.saveL=this.ImgOWidth=this.ImgOHeight=this.saveT=this.HTML5.lock=this.HTML5.PhotoHTML5True=false;this.rotate=this.ImgMainT=this.ImgDomT=this.ImgMainL=this.ImgDomL=0;this.preview.isW=[];this.preview.isH=[];this.ImgRotateFun=function(W,H){return[W,H];};},SendUserMsg:function(msg,n,p,b,c,i,k,f){this.arg.black.style.zIndex=i?199:99;this.pointhandle(n,5,msg,p,b,c,f);},again:function(){this.arg.SelectBox.style.visibility="visible";this.runImgUrl=false;this.arg.ImgDom.src=this.arg.ImgMain.src=this.arg.relativeUrl+"images/default.gif";},CoordinateData:function(True){var SendPHPSmaller=function(W,H,P){if(W<1){W=1;H=Math.round(1/P);}
if(H<1){H=1;W=Math.round(P);}
return[W,H];},SendArry={};True||(SendArry.url="../"+this.ImgUrl);var R={1:270,2:180,3:90,"90":270,"180":180,"270":90}[this.rotate]||(R=this.rotate),LT=this.ImgWidth,TL=this.ImgHeight,XYWH={0:LT,90:TL,180:LT,270:TL},XYWHP=this.ImgOWidth/XYWH[R];SendArry.R=R;SendArry.X=Math.round((Math.abs(this.ImgDomL)-this.Border)*XYWHP);SendArry.Y=Math.round((Math.abs(this.ImgDomT)-this.Border)*XYWHP);SendArry.P=this.arg.proportional[0];var P=this.formAllW/this.formAllH,Smaller=SendPHPSmaller(Math.round(this.formAllW*XYWHP),Math.round(this.formAllH*XYWHP),P);SendArry.IW=Smaller[0];SendArry.IH=Smaller[1];Smaller=SendPHPSmaller(this.formAllW,this.formAllH,P);SendArry.FW=Smaller[0];SendArry.FH=Smaller[1];return SendArry;},SendPHP:function(postArgs){var this_=this,SendArry,HTML5=this.HTML5,ResultData;this.SendUserMsg("正在为你处理截图，稍等...",0,2,"#fbeb61","#3a414c",true,true,function(){if((HTML5.HTML5PHP||HTML5.PhotoHTML5True)&&HTML5.canvas){try{HTML5.BOLBID&&HTML5.URL.revokeObjectURL(HTML5.BOLBID);SendArry=this_.CoordinateData(true);ResultData=HTML5.CanvasImg(SendArry,postArgs,this_);}catch(e){this_.SendUserMsg("错误：切割图片时严重报错,请更换浏览器试试，或者换张图片",5e3,0,"#f4102b","#fff",false);return;}}else{var POSTHTML="";if(Object.prototype.toString.call(postArgs)==="[object Object]"){for(var key in postArgs){POSTHTML+="&"+key+"="+postArgs[key];}}
SendArry=this_.CoordinateData();ResultData="JSdate="+window.ShearPhoto.JsonString.JsonToString(SendArry)+POSTHTML;}
this_.MyAjax.carry({url:this_.arg.url,data:ResultData,type:"POST",timeout:9e4,async:true,lock:true,complete:false,success:function(serverdata){serverdata=window.ShearPhoto.JsonString.StringToJson(serverdata);if(serverdata.status===false){this_.SendUserMsg(serverdata.info,5e3,0,"#f4102b","#fff",false);return;}else{this_.runImgUrl=false;typeof this_.complete==="function"&&this_.complete(serverdata);delete this_.HTML5.Images;}
if(serverdata["erro"]){this_.SendUserMsg("错误："+serverdata["erro"],5e3,0,"#f4102b","#fff",false);return;}},error:function(ErroMsg){this_.SendUserMsg("错误：连接后端失败，超时或后端无法运行",5e3,0,"#f4102b","#fff",false);},cache:false});});},DivDown:function(a){var this_=this,PNW=1,PNH=1,strLL="NO",strTT="NO",MaxW,MaxH,W,H,formParentoffsetLeft,formParent,formParentoffsetTop;return function(event){var event=event||window.event,eventbutton=event.button,typebutton=typeof eventbutton,clientX,clientY;event.preventDefault&&event.preventDefault();if(typebutton!=="number"){this_.eveMold=["touchstart","touchmove","touchend",function(events,clientXY){return events.touches[0][clientXY];}];clientX=event.touches[0].clientX;clientY=event.touches[0].clientY;}else{this_.eveMold=["mousedown","mousemove","mouseup",function(events,clientXY){return events[clientXY];}];clientX=event.clientX;clientY=event.clientY;}
if(eventbutton<2||typebutton!=="number"){W=this_.formAllW,H=this_.formAllH,formParent=this_.formParent,formParentoffsetLeft=this_.formLeft,formParentoffsetTop=this_.formTop;switch(a){case"BottomRight":MaxW=this_.relatW-formParentoffsetLeft,MaxH=this_.relatH-formParentoffsetTop;this_.arg.proportional[0]?this_.drawfun=this_.setHtrue:this_.drawfun=this_.setWHfalse;this_.PointerShape("nw-resize");break;case"TopRight":PNH=-1;strTT="TT";MaxW=this_.relatW-formParentoffsetLeft,MaxH=formParentoffsetTop+this_.formAllH;this_.arg.proportional[0]?this_.drawfun=this_.setHtrue:this_.drawfun=this_.setWHfalse;this_.PointerShape("ne-resize");break;case"Bottomleft":PNW=-1;strLL="LL";MaxW=formParentoffsetLeft+this_.formAllW;MaxH=this_.relatH-formParentoffsetTop;this_.arg.proportional[0]?this_.drawfun=this_.setHtrue:this_.drawfun=this_.setWHfalse;this_.PointerShape("ne-resize");break;case"Topleft":PNH=PNW=-1;strLL="LL";strTT="TT";MaxW=formParentoffsetLeft+this_.formAllW;MaxH=formParentoffsetTop+this_.formAllH;this_.arg.proportional[0]?this_.drawfun=this_.setHtrue:this_.drawfun=this_.setWHfalse;this_.PointerShape("nw-resize");break;case"Topmiddle":strLL="ML";var MaxWA=formParentoffsetLeft,MaxWB=this_.relatW-MaxWA-this_.formAllW;MaxW=Math.min(MaxWA,MaxWB)*2+this_.formAllW;strTT="TT";MaxH=formParentoffsetTop+this_.formAllH;PNH=-1;this_.arg.proportional[0]?this_.drawfun=this_.setHtrue:this_.drawfun=this_.setHfalse;this_.PointerShape("n-resize");break;case"leftmiddle":PNH=PNW=-1;MaxW=formParentoffsetLeft+this_.formAllW;var MaxHA=formParentoffsetTop,MaxHB=this_.relatH-MaxHA-this_.formAllH;MaxH=Math.min(MaxHA,MaxHB)*2+this_.formAllH;strTT="MT";strLL="LL";this_.arg.proportional[0]?this_.drawfun=this_.setWtrue:this_.drawfun=this_.setWfalse;this_.PointerShape("e-resize");break;case"Rightmiddle":MaxW=this_.relatW-formParentoffsetLeft;var MaxHA=formParentoffsetTop,MaxHB=this_.relatH-MaxHA-this_.formAllH;MaxH=Math.min(MaxHA,MaxHB)*2+this_.formAllH;strTT="MT";this_.arg.proportional[0]?this_.drawfun=this_.setWtrue:this_.drawfun=this_.setWfalse;this_.PointerShape("e-resize");break;case"Bottommiddle":var MaxWA=formParentoffsetLeft,MaxWB=this_.relatW-MaxWA-this_.formAllW;MaxW=Math.min(MaxWA,MaxWB)*2+this_.formAllW;MaxH=this_.relatH-formParentoffsetTop;this_.arg.proportional[0]?this_.drawfun=this_.setHtrue:this_.drawfun=this_.setHfalse;strLL="ML";this_.PointerShape("n-resize");break;default:break;}
var disX=clientX-PNW*W,disY=clientY-PNH*H;this.setCapture&&this.setCapture();typeof this_.DomMoveEve==="function"&&this_.delEvent(document,this_.eveMold[1],this_.DomMoveEve);this_.DomMoveEve=this_.DomMove(this_,this,disX,disY,PNW,PNH,formParent,MaxW,MaxH,strLL,strTT);this_.addEvent(document,this_.eveMold[1],this_.DomMoveEve);}else{this_.DomUp(this)();}
return false;};}};window.ShearPhoto.MINGGE=function(a){function b(){try{var c=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",c),a());},d=window.frameElement;}catch(e){return document.attachEvent("onreadystatechange",c),void 0;}
if(null!=d)
return document.attachEvent("onreadystatechange",c),void 0;try{document.documentElement.doScroll("left");}catch(c){return setTimeout(b,13),void 0;}
a();}
var c;"function"==typeof a&&(document.addEventListener?(c=function(){document.removeEventListener("DOMContentLoaded",c,!1),a();},document.addEventListener("DOMContentLoaded",c,!1)):b());};window.ShearPhoto.MoveDiv=function(){this.arg=new Array(),this.ReckonWH=this.DivW=this.DivH=this.selectionempty=this.addevent=this.DivDownEVe=this.DomMoveEve=this.DomUpEve=this.eveMold=false;};window.ShearPhoto.MoveDiv.prototype={ZeroSetting:function(){var getLT=this.HTML5.getLT(this.arg.form),left=parseFloat(getLT[0]),top=parseFloat(getLT[1]),size=this._size_(window,true),leftfun=function(){},topfun=function(){},tf=false;if(!isNaN(left)){tf=true;this.HTML5.setL(this.arg.form,0);leftfun=function(a,b){a<0&&(a=0);this_.HTML5.setL(b,left-a+"px");};}
if(!isNaN(top)){tf=true;this.HTML5.setT(this.arg.form,0);topfun=function(a,b){a<0&&(a=0);this_.HTML5.setT(b,top-a+"px");};}
if(tf===true){var size2=this._size_(window,true);leftfun(size.W-size2.W,this.arg.form);topfun(size.H-size2.H,this.arg.form);}},reckon:function(obj,se){this._size_(obj);var this_=this;if(se===true){var addfun=function(){this_.ZeroSetting();this_._size_(obj);this_.arg.MoveWidth=this_.ReckonWH.W;this_.arg.MoveHeight=this_.ReckonWH.H;this_.SetCenter(this_.arg);};this.addEvent(window,"resize",addfun);}},_size_:function(obj,t){var w,h,ReckonWH;if(obj===window){var DE={add:document.documentElement,att:document.body}[this.addevent];w=DE.clientWidth;h=DE.clientHeight;ReckonWH={W:Math.max(DE.scrollWidth,w),H:Math.max(DE.scrollHeight,h),CW:w,CH:h};}else{w=obj.offsetWidth;h=obj.offsetHeight;ReckonWH={W:w,H:h,CW:w,CH:h};}
if(t===true)
return ReckonWH;this.ReckonWH=ReckonWH;},DomUp:function(dom){var this_=this;return function(){dom.releaseCapture&&dom.releaseCapture();typeof this_.DomMoveEve==="function"&&this_.delEvent(document,this_.eveMold[1],this_.DomMoveEve);if(typeof this_.DomUpEve==="function"){this_.delEvent(document,this_.eveMold[2],this_.DomUpEve);this_.delEvent(window,this_.eveMold[2],this_.DomUpEve);this_.delEvent(window,"blur",this_.DomUpEve);this_.delEvent(dom,"losecapture",this_.DomUpEve);}
return false;};},DivWHFun:function(){this.DivW=this.arg.form.offsetWidth;this.DivH=this.arg.form.offsetHeight;},DomMove:function(this_,dom,disX,disY,formLeft,formTop){var argform=this_.arg.form,DivW=this_.DivW,DivH=this_.DivH,MoveScale,MoveFun=function(){},shifting=this_.arg.shifting=Object.prototype.toString.call(this_.arg.shifting)==="[object Array]"&&this_.arg.shifting.length>1?this_.arg.shifting:new Array(0,0),argMoveWidth=this_.arg.MoveWidth-shifting[0],argMoveHeight=this_.arg.MoveHeight-shifting[1];if(typeof this_.DomUpEve==="function"){this_.delEvent(document,this_.eveMold[2],this_.DomUpEve);this_.delEvent(window,this_.eveMold[2],this_.DomUpEve);this_.delEvent(window,"blur",this_.DomUpEve);this_.delEvent(dom,"losecapture",this_.DomUpEve);}
this_.DomUpEve=this_.DomUp(dom);this_.addEvent(document,this_.eveMold[2],this_.DomUpEve);this_.addEvent(window,this_.eveMold[2],this_.DomUpEve);this_.addEvent(window,"blur",this_.DomUpEve);this_.addEvent(dom,"losecapture",this_.DomUpEve);var maxL=argMoveWidth-DivW,maxT=argMoveHeight-DivH,iL,iT,eveclientX,eveclientY;typeof this_.arg.MoveFun==="function"&&(MoveFun=this_.arg.MoveFun);MoveScale=[maxL,maxT];return function(eve){eve=eve||window.event;if(eve.button>1){this_.DomUp(this)();return false;}
eveclientX=this_.eveMold[3](eve,"clientX"),eveclientY=this_.eveMold[3](eve,"clientY");setTimeout(function(){iL=eveclientX-disX;iT=eveclientY-disY;this_.selectionempty();iL=iL<-shifting[0]?-shifting[0]:iL;iL=iL>maxL?maxL:iL;iT=iT<-shifting[1]?-shifting[1]:iT;iT=iT>maxT?maxT:iT;this_.HTML5.setLT(argform,iL+"px",iT+"px");MoveFun(iL,iT,MoveScale);},1);return false;};},DivDown:function(){var this_=this;return function(event){var event=event||window.event,eventbutton=event.button,typebutton=typeof eventbutton,clientX,clientY;event.preventDefault&&event.preventDefault();if(typebutton!=="number"){this_.eveMold=["touchstart","touchmove","touchend",function(events,clientXY){return events.touches[0][clientXY];}];clientX=event.touches[0].clientX;clientY=event.touches[0].clientY;}else{this_.eveMold=["mousedown","mousemove","mouseup",function(events,clientXY){return events[clientXY];}];clientX=event.clientX;clientY=event.clientY;}
if(eventbutton<2||typebutton!=="number"){var getLT=this_.HTML5.getLT(this_.arg.form),formLeft=parseFloat(getLT[0]),formTop=parseFloat(getLT[1]),disX=clientX-formLeft,disY=clientY-formTop;this.setCapture&&this.setCapture();typeof this_.arg.DivDownFun==="function"&&this_.arg.DivDownFun(this_);typeof this_.DomMoveEve==="function"&&this_.delEvent(document,this_.eveMold[1],this_.DomMoveEve);this_.DomMoveEve=this_.DomMove(this_,this,disX,disY,formLeft,formTop);this_.addEvent(document,this_.eveMold[1],this_.DomMoveEve);}else{this_.DomUp(this)();}
return false;};},ShearPhotoDown:function(obj,fun){this.addEvent(obj,"mousedown",fun);this.addEvent(obj,"touchstart",fun);},delShearPhotoDown:function(obj,fun){this.delEvent(obj,"mousedown",fun);this.delEvent(obj,"touchstart",fun);},et:function(){var this_=this;var cursor=this.arg.cursor||"move";this_=this;for(var i=0;i<this.arg.to.length;i++){if(this.addevent==="add"){if(typeof this.DivDownEVe!=="function"){this.DivDownEVe=this.DivDown();}else{this.delShearPhotoDown(this.arg.to[i],this.DivDownEVe);}
this.ShearPhotoDown(this.arg.to[i],this.DivDownEVe);}else{this.arg.to[i].onmousedown=this.DivDown();}
this.arg.to[i].style["cursor"]=cursor;}},delDownEve:function(){for(var i=0;i<this.arg.to.length;i++){if(this.addevent==="add"){if(typeof this.DivDownEVe==="function"){this.delShearPhotoDown(this.arg.to[i],this.DivDownEVe);}}}},setdiv:function(argform,CW,CH,arg){if(typeof arg.centerFront==="function"){var CWCH=arg.centerFront();CW=CWCH[0];CH=CWCH[1];}
var DivT=Math.round((CH-this.DivH)*.5);DivT=DivT<0?0:DivT;var DivL=Math.round((CW-this.DivW)*.5);DivL=DivL<0?0:DivL;this.HTML5.setLT(argform,DivL+"px",DivT+"px");typeof arg.centerfun==="function"&&arg.centerfun(DivL,DivT,this);},addEvent:function(obj,evetype,fun){var addevent={add:function(){obj.addEventListener(evetype,fun,false);},att:function(){obj.attachEvent("on"+evetype,fun);}};addevent[this.addevent]&&addevent[this.addevent]();},delEvent:function(obj,evetype,fun){var delevent={add:function(){obj.removeEventListener(evetype,fun,false);},att:function(){obj.detachEvent("on"+evetype,fun);}};delevent[this.addevent]&&delevent[this.addevent]();},SetCenter:function(arg){if(arg.center){if(arg.center===1){var CW=this.ReckonWH.CW,CH=this.ReckonWH.CH;}else{var ReckonWH=this._size_(arg.center,true);var CW=ReckonWH.CW,CH=ReckonWH.CH;}
this.setdiv(arg.form,CW,CH,arg);}},run:function(arg){this.arg=arg;this.DivW=arg.form.offsetWidth;this.DivH=arg.form.offsetHeight;this.SetCenter(arg);typeof arg.zIndex==="number"&&(arg.form.style.zIndex=arg.zIndex);this.et();}};window.ShearPhoto.JsonString={_json_:null,JsonToString:function(arr){try{this._json_=new Array();this._read_(arr,true);var JsonJoin=this._json_.join("");JsonJoin=JsonJoin.replace(/,([\}\]])/g,function(a,b){return b;});this._json_=null;return JsonJoin;}catch(e){alert("发生错误，错误代码--"+e);return"";}},StringToJson:function(arrtxt){if(typeof arrtxt!=="string"){alert("请传入JSON字串符");return;}
try{var array=new Function("return "+"("+arrtxt+")")();var type=this._type_(array);if(type!=="[object Object]"&&type!=="[object Array]"){alert("严重报错：后端没返回到JSON，而是一串无效字符串。\n\n你是在调试吗？\n\n那么按确定，查看那串无效字符串吧");alert(arrtxt);return false;}
return array;}catch(e){alert("严重报错：后端没返回到JSON，而是一串无效字符串。\n\n你是在调试吗？\n\n那么按确定，查看那串无效字符串吧");alert(arrtxt);return false;}},_type_:function(arr){if(typeof arr.nodeType==="number")
return"[object document]";var Types=Object.prototype.toString.call(arr);return Types;},_addjson_:function(types,txt,txt2,TrueFalse){var run={"[object Object]":txt,"[object Array]":txt2};this._json_.push(run[types]);},_addstring_:function(parameter){var of=typeof parameter;if(of==="string")
return'"'+parameter+'"';else if(of==="number")
return parameter;var types=this._type_(parameter);if(types==="[object Object]"||types==="[object Array]"){return false;}else
return'""';},_read_:function(arr,TrueFalse){var types=this._type_(arr);if(TrueFalse&&types!=="[object Object]"&&types!=="[object Array]"){alert("你传入不是数组或JSON");this._json_=null;return false;}
this._addjson_(types,"{","[",TrueFalse);for(var a in arr){if(typeof arr.constructor.prototype[a]==="undefined"){var ArrA=this._addstring_(arr[a]);if(typeof ArrA!=="boolean"){this._addjson_(types,'"'+a+'":'+ArrA+",",ArrA+",");}else{this._addjson_(types,'"'+a+'":',"");this._read_(arr[a],false);}}}
TrueFalse=TrueFalse?"":",";this._addjson_(types,"}"+TrueFalse,"]"+TrueFalse);}};window.ShearPhoto.MyAjax=function(){this.serverdata=this.erromsg=this.timeout=this.stop=this.xmlhttp=false;this.transit=true;};window.ShearPhoto.MyAjax.prototype.handle=function(xmlhttp,arg){if(4==xmlhttp.readyState){if(this.stop===true)
return;this.transit=true;if(arg.timeout&&arg.async){clearTimeout(this.timeout);this.timeout=false;}
if(200==xmlhttp.status){var responseText=this.serverdata=xmlhttp.responseText.replace(/(^\s*)|(\s*$)/g,"");typeof arg.success==="function"&&arg.success(responseText);}else{this.erromsg=xmlhttp.status;typeof arg.error==="function"&&arg.error(xmlhttp.status);}}else{if(0==xmlhttp.readyState){if(this.stop===true)
return;if(arg.timeout&&arg.async){clearTimeout(this.timeout);this.timeout=false;}
this.erromsg=xmlhttp.readyState;this.transit=true;typeof arg.error==="function"&&arg.error(xmlhttp.readyState);}}};window.ShearPhoto.MyAjax.prototype.out=function(arg){this.transit=true;this.erromsg=504;this.stop=true;typeof arg.error==="function"&&arg.error(504);};window.ShearPhoto.MyAjax.prototype.carry=function(arg){if(arg.lock&&!this.transit)
return false;this.transit=false;this.stop=this.erromsg=false;var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest();}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}
arg.type=arg.type.toUpperCase();var ContentType=function(){};if(typeof arg.data==="string"){arg.data=arg.data.replace(/(^\s*)|(\s*$)/g,"");ContentType=function(){xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");};}else{if(Object.prototype.toString.call(arg.data)!=="[object FormData]"){arg.data="";ContentType=function(){xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");};}else{typeof arg.progress==="function"&&xmlhttp.upload.addEventListener("progress",arg.progress,false);arg.type="POST";}}
var SendArg=arg.data==""?[null,""]:[arg.data,"?"+arg.data];var self=this;typeof arg.complete==="function"&&arg.complete();arg.timeout&&arg.async&&(this.timeout=setTimeout(function(){self.out(arg);},arg.timeout));if(arg.async===true){xmlhttp.onreadystatechange=function(){self.handle(xmlhttp,arg);};}
try{switch(arg.type){case"POST":xmlhttp.open("POST",arg.url,arg.async);ContentType();break;default:xmlhttp.open("GET",arg.url+SendArg[1],arg.async);arg.cache===true||xmlhttp.setRequestHeader("If-Modified-Since","0");break;}}catch(e2){this.erromsg=505;if(arg.timeout&&arg.async){clearTimeout(this.timeout);this.timeout=false;}
this.transit=true;typeof arg.error==="function"&&arg.error(505);return;}
xmlhttp.send(SendArg[0]);if(arg.async===false){self.handle(xmlhttp,arg);}};window.ShearPhoto.frameUpImg=function(config){this.BodyDom=document.body;this.FORM=config.FORM;this.upfile=this.FORM.UpFile;this.config=config;this.upfileclick=false;typeof config.erro!=="function"&&(config.erro=function(){});this.FORM.action=config["url"];var this_=this;this.parentNodes=this.upfile.parentNode;if(window.attachEvent){this.parentNodes.onmousemove=function(){var offsetX=window.event.offsetX+5;offsetX<0&&(offsetX=0);offsetX>224&&(offsetX=224);this_.upfile.style.width=offsetX+"px";};}};window.ShearPhoto.frameUpImg.prototype={createframe:function(){this.BodyDom.insertAdjacentHTML("afterBegin",'<iframe name="POSTiframe"   class="displayNone"  ></iframe>');this.iframe=document.getElementsByName("POSTiframe")[0];this.createEve(this.iframe,window.frames["POSTiframe"]);},createEve:function(iframe,windowframes){var this_=this;if(this.upfile.files){iframe.onload=function(){iframe.onload=null;var windowframesbody=windowframes.document.getElementsByTagName("BODY")[0];var html=windowframesbody.innerHTML;this_.Evebubbling(html);};}else{iframe.onreadystatechange=function(){if(iframe.readyState==="complete"){iframe.onreadystatechange=null;var windowframesbody=windowframes.document.getElementsByTagName("BODY")[0];var html=windowframesbody.innerHTML;this_.Evebubbling(html);}};}},delframe:function(){this.BodyDom.removeChild(this.iframe);this.DelCreateUpfile();},Evebubbling:function(html){if(html!=""){this.upfile.onclick=this.upfileclick;typeof this.fun==="function"&&this.fun(html);this.delframe();}},inArray:function(elem,array){if(array.indexOf){return array.indexOf(elem);}
for(var i=0,length=array.length;i<length;i++){if(array[i]===elem){return i;}}
return-1;},DelCreateUpfile:function(){var change=this.upfile.onchange;this.upfile.onchange=this.upfile.onclick=null;this.parentNodes.removeChild(this.upfile);var inputfile=document.createElement("input");inputfile.setAttribute("type","file");inputfile.setAttribute("name","UpFile");this.parentNodes.appendChild(inputfile);this.upfile=inputfile;this.upfile.onchange=change;this.upfile.onclick=this.upfileclick;},Upsubmit:function(upfile){try{var filestype=upfile.value.split(".");filestype=Object.prototype.toString.call(filestype)==="[object Array]"?filestype[filestype.length-1]:"";if(this.inArray(filestype.toLowerCase(),this.config.UpType)==-1){this.DelCreateUpfile();$('#saveShear').hide();$('.upload-avatar-popup').hide();$('.mask').remove();_dialog.alert('图片格式一定要是JPG，PNG中的一种');return;}
var files=upfile.files,type;if(files){files=files[0];files.type&&(type=files.type==="image/gif"?"image/jpeg":files.type,this.config.HTML5.ImagesType=type);if(files.size<=0){this.DelCreateUpfile();this.config.erro("错误：不能选择空字节文件");return;}
if(this.config.HTML5.canvas){if(files.size>this.config.HTML5FilesSize*1024*1024){this.DelCreateUpfile();this.config.erro("错误：HTML5上传不能大于"+this.config.HTML5FilesSize+"M");return;}}else if(files.size>this.config.FilesSize*1024*1024){this.DelCreateUpfile();this.config.erro("错误：文件不能大于"+this.config.FilesSize+"M");return;}}
var this_=this;typeof this.config.preced==="function"&&this.config.preced(function(){if(this_.config.HTML5.canvas){var reader=new FileReader();reader.onload=function(){this_.DelCreateUpfile();this_.config.HTML5.zipImg(this.result,this_.config.HTML5ZIP,type,function(DataUrl){typeof this_.fun==="function"&&this_.fun({success:DataUrl},true);delete(reader);});};reader.readAsDataURL(files);return;}
this_.createframe();this_.FORM.submit();});}catch(e){this.DelCreateUpfile();this.config.erro("你选择了非图片类型，或 图片路径有误");return;}},run:function(fun){var this_=this;this.fun=fun;this.upfile.onclick=this.upfileclick=function(){typeof this_.config.fileClick==="function"&&this_.config.fileClick();};this.upfile.onchange=function(){if(this.value=="")
return false;this.onclick=function(){return false;};this_.Upsubmit(this);};}};_util.initNameSpace("CS.shearPhoto");})(jQuery);(function($){var _util=CS.util,_dialog=CS.dialog;window.ShearPhoto.MINGGE(function(){var relativeUrl="/authors/shearphoto_common";relativeUrl=relativeUrl.replace(/(^\s*)|(\s*$)/g,"");relativeUrl===""||(relativeUrl);var publicRelat=document.getElementById("relat");var publicRelatImg=publicRelat.getElementsByTagName("img");var Shear=new ShearPhoto;Shear.config({relativeUrl:relativeUrl,traverse:true,translate3d:false,HTML5:true,HTML5MAX:500,HTML5Quality:0.9,HTML5FilesSize:50,HTML5Effects:false,HTML5ZIP:[900,0.9],preview:false,url:relativeUrl+"",scopeWidth:256,scopeHeight:256,proportional:[1/1,200,200],Min:200,Max:256,backgroundColor:"#fff",backgroundOpacity:0.9,Border:0,BorderStyle:"solid",BorderColor:"#09F",relat:publicRelat,scope:document.getElementById("main"),ImgDom:publicRelatImg[0],ImgMain:publicRelatImg[1],black:document.getElementById("black"),form:document.getElementById("smallbox"),ZoomDist:document.getElementById("ZoomDist"),ZoomBar:document.getElementById("ZoomBar"),to:{BottomRight:document.getElementById("BottomRight"),TopRight:document.getElementById("TopRight"),Bottomleft:document.getElementById("Bottomleft"),Topleft:document.getElementById("Topleft"),Topmiddle:document.getElementById("Topmiddle"),leftmiddle:document.getElementById("leftmiddle"),Rightmiddle:document.getElementById("Rightmiddle"),Bottommiddle:document.getElementById("Bottommiddle")},Effects:document.getElementById("shearphoto_Effects")||false,DynamicBorder:[document.getElementById("borderTop"),document.getElementById("borderLeft"),document.getElementById("borderRight"),document.getElementById("borderBottom")],SelectBox:document.getElementById("SelectBox"),Shearbar:document.getElementById("Shearbar"),UpFun:function(){Shear.MoveDiv.DivWHFun();}});Shear.complete=function(serverdata){var point=this.arg.scope.childNodes[0];point.className==="point"&&this.arg.scope.removeChild(point);var complete=document.createElement("div");complete.className="complete";complete.style.height=this.arg.scopeHeight+"px";this.arg.scope.insertBefore(complete,this.arg.scope.childNodes[0]);var length=serverdata.length,creatImg;for(var i=0;i<length;i++){creatImg=document.createElement("img");complete.appendChild(creatImg);creatImg.src=this.arg.relativeUrl+serverdata[i]["ImgUrl"];}
this.HTML5.EffectsReturn();this.HTML5.BOLBID&&this.HTML5.URL.revokeObjectURL(this.HTML5.BOLBID);creatImg=document.createElement("DIV");creatImg.className="completeTxt";creatImg.innerHTML='<strong><i></i>恭喜你！截图成功</strong><a href="javascript:;" id="completeA">完成</a>';complete.appendChild(creatImg);$('.closePopup').addClass('disabled');var completeA=document.getElementById("completeA");var this_=this;this_.preview.close_();completeA.onclick||(completeA.onclick=function(){completeA.onclick=null;this_.arg.scope.removeChild(complete);this_.again();this_.pointhandle(3e3,10,"截图完成！已返回！",2,"#fbeb61","#3a414c");$('.closePopup').removeClass('disabled');if(serverdata.status){$('#previewImg').attr('src',serverdata.info);$('.upload-avatar-popup').hide();$("input[name='headimg']").val(serverdata.info);}else{Shear.SendUserMsg("错误：请保证后端环境运行正常",5e3,0,"#f4102b","#fff",true,true);}});};var photoalbum=document.getElementById("photoalbum");var ShearPhotoForm=document.getElementById("ShearPhotoForm");ShearPhotoForm.UpFile.onclick=function(){return false};var up=new ShearPhoto.frameUpImg({url:relativeUrl+"php/upload.php",FORM:ShearPhotoForm,UpType:new Array("jpg","jpeg","png"),FilesSize:2,HTML5:Shear.HTML5,HTML5FilesSize:Shear.arg.HTML5FilesSize,HTML5ZIP:Shear.arg.HTML5ZIP,erro:function(msg){Shear.pointhandle(3e3,10,msg,0,"#f82373","#fff");},fileClick:function(){Shear.pointhandle(-1);},preced:function(fun){$('.upload-avatar-popup').show();try{photoalbum.style.display="none";camClose.onclick();}catch(e){}
Shear.pointhandle(0,10,"正在为你加载图片，请你稍等哦......",2,"#307ff6","#fff",fun);}});up.run(function(data,True){True||(data=ShearPhoto.JsonString.StringToJson(data));if(data===false){Shear.SendUserMsg("错误：请保证后端环境运行正常",5e3,0,"#f4102b","#fff",true,true);return;}
if(data["erro"]){Shear.SendUserMsg("错误："+data["erro"],5e3,0,"#f4102b","#fff",true,true);return;}
Shear.run(data["success"],true);});try{var AllType={".jpg":"image/jpeg",".jpeg":"image/jpeg",".gif":"image/jpeg",".png":"image/png"};var URLType=function(url){return AllType[/\.[^.]+$/.exec(url)]||"image/jpeg";};var DE=document.documentElement;var PhotoLoading=document.getElementById("PhotoLoading");var photoalbumLi=photoalbum.getElementsByTagName("li");var photoalbumLifun=function(){var serveUrl=this.getElementsByTagName("img")[0].getAttribute("serveUrl");Shear.HTML5.ImagesType=URLType(serveUrl);Shear.run(serveUrl);photoalbum.style.display="none";};for(var i=0;i<photoalbumLi.length;i++)
photoalbumLi[i].onclick=photoalbumLifun;PhotoLoading.onclick=function(){photoalbum.style.display="block";};document.getElementById("close").onclick=function(){photoalbum.style.display="none";};}catch(e){}
Shear.addEvent(document.getElementById("saveShear"),"click",function(){Shear.SendPHP({shearphoto:"我要传参数到服端",mingge:"我要传第二个参数到服务器"});});Shear.addEvent(document.getElementById("LeftRotate"),"click",function(){Shear.Rotate("left");});Shear.addEvent(document.getElementById("RightRotate"),"click",function(){Shear.Rotate("right");});try{webcam.init_config={width:200,height:200,server_width:450,server_height:450,uploadfield:"UpFile",postargs:{mingge:"shearphoto我爱你",shearphoto:"shearphoto好"}},webcam.set_api_url(relativeUrl+"php/upload.php");webcam.set_swf_url(relativeUrl+"images/webcam.swf");webcam.set_shutter_sound(true,relativeUrl+"images/shutter.mp3")
webcam.set_quality(95);var CamFlash=document.getElementById("CamFlash");var timing=document.getElementById("timing");var CamOk=document.getElementById("CamOk");var CamBox=document.getElementById("CamBox");var camerasImage=document.getElementById("camerasImage");var camClose=document.getElementById("camClose");var setCam=document.getElementById("setCam");webcam.noCamcall=function(msg){Shear.SendUserMsg(msg,5e3,0,"#f4102b","#fff",true,true);camClose.onclick();}
setCam.onclick=function(){webcam.configure();}
camClose.onclick=function(){webcam.Homing(timing);CamFlash.innerHTML="";CamBox.style.display="none";camerasImage.onclick=camerasImageOnclick;};var camerasImageOnclick=function(){CamBox.style.display="block";CamFlash.innerHTML=webcam.get_html();webcam.newsnap(timing,CamFlash,CamOk);camerasImage.onclick=null;};camerasImage.onclick=camerasImageOnclick;webcam.set_hook("onComplete",function(data){camClose.onclick();data=ShearPhoto.JsonString.StringToJson(data);if(data===false){Shear.SendUserMsg("错误：请保证后端环境运行正常",5e3,0,"#f4102b","#fff",true,true);return;}
if(data["erro"]){Shear.SendUserMsg("错误："+data["erro"],5e3,0,"#f4102b","#fff",true,true);return;}
Shear.HTML5.ImagesType="image/jpeg";Shear.run(data["success"]);});}catch(e){}
var shearphoto_loading=document.getElementById("shearphoto_loading");var shearphoto_main=document.getElementById("shearphoto_main");shearphoto_loading&&shearphoto_loading.parentNode.removeChild(shearphoto_loading);shearphoto_main.style.visibility="visible";});_util.initNameSpace("CS.shearSetup");})(jQuery);